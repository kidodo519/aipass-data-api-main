(self.webpackChunk_stoplight_ninja=self.webpackChunk_stoplight_ninja||[]).push([[4513],{2319:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(2339),i=r(26514),o=r(36275),s=r(36596),a=function(){function e(e){void 0===e&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),"string"==typeof e.hostname&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new i.I(this._shutdown,this),this._concurrencyLimit="number"==typeof e.concurrencyLimit?e.concurrencyLimit:1/0,this.timeoutMillis=(0,s.rH)(e.timeoutMillis),this.onInit(e)}return e.prototype.export=function(e,t){if(this._shutdownOnce.isCalled){t({code:o.V.FAILED,error:Error("Exporter has been shutdown")});return}if(this._sendingPromises.length>=this._concurrencyLimit){t({code:o.V.FAILED,error:Error("Concurrent export limit reached")});return}this._export(e).then(function(){t({code:o.V.SUCCESS})}).catch(function(e){t({code:o.V.FAILED,error:e})})},e.prototype._export=function(e){var t=this;return new Promise(function(r,i){try{n.s.debug("items to be sent",e),t.send(e,r,i)}catch(e){i(e)}})},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype.forceFlush=function(){return Promise.all(this._sendingPromises).then(function(){})},e.prototype._shutdown=function(){return n.s.debug("shutdown started"),this.onShutdown(),this.forceFlush()},e}(),u=function(){var e=function(t,r){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),l=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.name="OTLPExporterError",i.data=n,i.code=r,i}return u(t,e),t}(Error),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},E=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},p=r(44874),d=r(23202),f=r(17668),_=function(){var e=function(t,r){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),h=function(e){function t(t){void 0===t&&(t={});var r=e.call(this,t)||this;return r._useXHR=!1,r._useXHR=!!t.headers||"function"!=typeof navigator.sendBeacon,r._useXHR?r._headers=Object.assign({},(0,s.QG)(t.headers),p.hD((0,d._)().OTEL_EXPORTER_OTLP_HEADERS)):r._headers={},r}return _(t,e),t.prototype.onInit=function(){f.X.addEventListener("unload",this.shutdown)},t.prototype.onShutdown=function(){f.X.removeEventListener("unload",this.shutdown)},t.prototype.send=function(e,t,r){var i=this;if(this._shutdownOnce.isCalled){n.s.debug("Shutdown already started. Cannot send objects");return}var o=JSON.stringify(this.convert(e)),a=new Promise(function(e,t){var r,a,u,p,d,f,_,h,g,v;i._useXHR?(r=i.url,a=i._headers,u=i.timeoutMillis,f=!1,_=setTimeout(function(){clearTimeout(p),f=!0,d.readyState===XMLHttpRequest.DONE?t(new l("Request Timeout")):d.abort()},u),(h=function(i,u){void 0===i&&(i=s.J9),void 0===u&&(u=s.Tj),(d=new XMLHttpRequest).open("POST",r),Object.entries(c(c({},{Accept:"application/json","Content-Type":"application/json"}),a)).forEach(function(e){var t=E(e,2),r=t[0],n=t[1];d.setRequestHeader(r,n)}),d.send(o),d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&!1===f&&(d.status>=200&&d.status<=299?(n.s.debug("xhr success",o),e(),clearTimeout(_),clearTimeout(p)):d.status&&(0,s.$q)(d.status)&&i>0?(u=s.Q5*u,p=setTimeout(function(){h(i-1,u)},d.getResponseHeader("Retry-After")?(0,s.u6)(d.getResponseHeader("Retry-After")):Math.round(Math.random()*(s.Rr-u)+u))):(t(new l("Failed to export with XHR (status: "+d.status+")",d.status)),clearTimeout(_),clearTimeout(p)))},d.onabort=function(){f&&t(new l("Request Timeout")),clearTimeout(_),clearTimeout(p)},d.onerror=function(){f&&t(new l("Request Timeout")),clearTimeout(_),clearTimeout(p)}})()):(g=i.url,v={type:"application/json"},navigator.sendBeacon(g,new Blob([o],v))?(n.s.debug("sendBeacon - can send",o),e()):t(new l("sendBeacon - cannot send "+o)))}).then(t,r);this._sendingPromises.push(a);var u=function(){var e=i._sendingPromises.indexOf(a);i._sendingPromises.splice(e,1)};a.then(u,u)},t}(a)},36596:(e,t,r)=>{"use strict";r.d(t,{$q:()=>_,Ir:()=>E,J9:()=>s,Q5:()=>l,QG:()=>c,Rr:()=>u,Tj:()=>a,rH:()=>d,u3:()=>p,u6:()=>h});var n=r(2339),i=r(23202),o=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},s=5,a=1e3,u=5e3,l=1.5;function c(e){void 0===e&&(e={});var t={};return Object.entries(e).forEach(function(e){var r=o(e,2),i=r[0],s=r[1];void 0!==s?t[i]=String(s):n.s.warn('Header "'+i+'" has wrong value and will be ignored')}),t}function E(e,t){return e.endsWith("/")||(e+="/"),e+t}function p(e){try{var t=new URL(e);return""===t.pathname&&(t.pathname=t.pathname+"/"),t.toString()}catch(t){return n.s.warn("Could not parse export URL: '"+e+"'"),e}}function d(e){var t,r;return"number"!=typeof e?(r=Number(null!==(t=(0,i._)().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)&&void 0!==t?t:(0,i._)().OTEL_EXPORTER_OTLP_TIMEOUT))<=0?f(r,1e4):r:e<=0?f(e,1e4):e}function f(e,t){return n.s.warn("Timeout must be greater than 0",e),t}function _(e){return[429,502,503,504].includes(e)}function h(e){if(null==e)return -1;var t=Number.parseInt(e,10);if(Number.isInteger(t))return t>0?1e3*t:-1;var r=new Date(e).getTime()-Date.now();return r>=0?r:0}},68266:(e,t,r)=>{"use strict";r.d(t,{s:()=>h});var n=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s};function i(e){return Object.keys(e).map(function(t){return function e(t,r){return{key:t,value:function t(r){var i=typeof r;return"string"===i?{stringValue:r}:"number"===i?Number.isInteger(r)?{intValue:r}:{doubleValue:r}:"boolean"===i?{boolValue:r}:r instanceof Uint8Array?{bytesValue:r}:Array.isArray(r)?{arrayValue:{values:r.map(t)}}:"object"===i&&null!=r?{kvlistValue:{values:Object.entries(r).map(function(t){var r=n(t,2);return e(r[0],r[1])})}}:{}}(r)}}(t,e[t])})}var o=r(41437),s=r(99744),a=BigInt(1e9);function u(e){return BigInt(e[0])*a+BigInt(e[1])}function l(e){var t;return{low:Number(BigInt.asUintN(32,t=u(e))),high:Number(BigInt.asUintN(32,t>>BigInt(32)))}}var c="undefined"!=typeof BigInt?function(e){return u(e).toString()}:o.u5;function E(e){return e}function p(e){if(void 0!==e)return(0,s.O)(e)}var d={encodeHrTime:l,encodeSpanContext:s.O,encodeOptionalSpanContext:p},f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s};function h(e,t){return{resourceSpans:function(e,t){for(var r=function(e){var t,r,n=new Map;try{for(var i=f(e),o=i.next();!o.done;o=i.next()){var s=o.value,a=n.get(s.resource);a||(a=new Map,n.set(s.resource,a));var u=s.instrumentationLibrary.name+"@"+(s.instrumentationLibrary.version||"")+":"+(s.instrumentationLibrary.schemaUrl||""),l=a.get(u);l||(l=[],a.set(u,l)),l.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n}(e),n=[],o=r.entries(),s=o.next();!s.done;){for(var a=_(s.value,2),u=a[0],l=a[1],c=[],E=l.values(),p=E.next();!p.done;){var d=p.value;if(d.length>0){var h=d[0].instrumentationLibrary,g=h.name,v=h.version,I=h.schemaUrl,T=d.map(function(e){return function(e,t){var r,n=e.spanContext(),o=e.status;return{traceId:t.encodeSpanContext(n.traceId),spanId:t.encodeSpanContext(n.spanId),parentSpanId:t.encodeOptionalSpanContext(e.parentSpanId),traceState:null===(r=n.traceState)||void 0===r?void 0:r.serialize(),name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:t.encodeHrTime(e.startTime),endTimeUnixNano:t.encodeHrTime(e.endTime),attributes:i(e.attributes),droppedAttributesCount:e.droppedAttributesCount,events:e.events.map(function(e){return{attributes:e.attributes?i(e.attributes):[],name:e.name,timeUnixNano:t.encodeHrTime(e.time),droppedAttributesCount:e.droppedAttributesCount||0}}),droppedEventsCount:e.droppedEventsCount,status:{code:o.code,message:o.message},links:e.links.map(function(e){return function(e,t){var r;return{attributes:e.attributes?i(e.attributes):[],spanId:t.encodeSpanContext(e.context.spanId),traceId:t.encodeSpanContext(e.context.traceId),traceState:null===(r=e.context.traceState)||void 0===r?void 0:r.serialize(),droppedAttributesCount:e.droppedAttributesCount||0}}(e,t)}),droppedLinksCount:e.droppedLinksCount}}(e,t)});c.push({scope:{name:g,version:v},spans:T,schemaUrl:I})}p=E.next()}var O={resource:{attributes:i(u.attributes),droppedAttributesCount:0},scopeSpans:c,schemaUrl:void 0};n.push(O),s=o.next()}return n}(e,function(e){if(void 0===e)return d;var t,r,n=null===(t=e.useLongBits)||void 0===t||t,i=null!==(r=e.useHex)&&void 0!==r&&r;return{encodeHrTime:n?l:c,encodeSpanContext:i?E:s.O,encodeOptionalSpanContext:i?E:p}}(t))}}},35684:(e,t,r)=>{"use strict";r.d(t,{F:()=>l});var n=r(2339),i=r(42152),o=r(59988),s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},u=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},l=function(){function e(e,t){var r,i=this;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(r=this._attributes)&&void 0!==r?r:{},this._asyncAttributesPromise=null==t?void 0:t.then(function(e){return i._attributes=Object.assign({},i._attributes,e),i.asyncAttributesPending=!1,e},function(e){return n.s.debug("a resource's async attributes promise rejected: %s",e),i.asyncAttributesPending=!1,{}})}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[i._2.SERVICE_NAME]="unknown_service",t[i._2.TELEMETRY_SDK_LANGUAGE]=o.q[i._2.TELEMETRY_SDK_LANGUAGE],t[i._2.TELEMETRY_SDK_NAME]=o.q[i._2.TELEMETRY_SDK_NAME],t[i._2.TELEMETRY_SDK_VERSION]=o.q[i._2.TELEMETRY_SDK_VERSION],t))},Object.defineProperty(e.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&n.s.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}},enumerable:!1,configurable:!0}),e.prototype.waitForAsyncAttributes=function(){var e,t,r,n;return e=this,t=void 0,r=void 0,n=function(){return a(this,function(e){switch(e.label){case 0:if(!this.asyncAttributesPending)return[3,2];return[4,this._asyncAttributesPromise];case 1:e.sent(),e.label=2;case 2:return[2]}})},new(r||(r=Promise))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},e.prototype.merge=function(t){var r,n=this;if(!t)return this;var i=s(s({},this._syncAttributes),null!==(r=t._syncAttributes)&&void 0!==r?r:t.attributes);return this._asyncAttributesPromise||t._asyncAttributesPromise?new e(i,Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then(function(e){var r,i=u(e,2),o=i[0],a=i[1];return s(s(s(s({},n._syncAttributes),o),null!==(r=t._syncAttributes)&&void 0!==r?r:t.attributes),a)})):new e(i)},e.EMPTY=new e({}),e}()},14515:(e,t,r)=>{"use strict";var n;r.d(t,{i:()=>n}),function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(n||(n={}))},61055:(e,t,r)=>{"use strict";r.d(t,{J:()=>f});var n=r(2339),i=r(14138),o=r(33835),s=r(23202),a=r(26514),u=r(65890),l=r(36275),c=r(30675),E=r(35575),p=function(){function e(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=(0,s._)();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new a.I(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(n.s.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||(e.spanContext().traceFlags&i.X.SAMPLED)==0||this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},e.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){0===this._droppedSpansCount&&n.s.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(n.s.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},e.prototype._flushAll=function(){var e=this;return new Promise(function(t,r){for(var n=[],i=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),o=0;o<i;o++)n.push(e._flushOneBatch());Promise.all(n).then(function(){t()}).catch(r)})},e.prototype._flushOneBatch=function(){var e=this;return(this._clearTimer(),0===this._finishedSpans.length)?Promise.resolve():new Promise(function(t,r){var n=setTimeout(function(){r(Error("Timeout"))},e._exportTimeoutMillis);o._.with((0,u.M1)(o._.active()),function(){var i=e._finishedSpans.splice(0,e._maxExportBatchSize),o=function(){return e._exporter.export(i,function(e){var i;clearTimeout(n),e.code===l.V.SUCCESS?t():r(null!==(i=e.error)&&void 0!==i?i:Error("BatchSpanProcessor: span export failed"))})},s=i.map(function(e){return e.resource}).filter(function(e){return e.asyncAttributesPending});0===s.length?o():Promise.all(s.map(function(e){var t;return null===(t=e.waitForAsyncAttributes)||void 0===t?void 0:t.call(e)})).then(o,function(e){(0,c.s)(e),r(e)})})})},e.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().then(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(t){e._isExporting=!1,(0,c.s)(t)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout(function(){return t()},this._scheduledDelayMillis),(0,E.K)(this._timer))}},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),d=function(){var e=function(t,r){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.onInit(r),n}return d(t,e),t.prototype.onInit=function(e){var t=this;(null==e?void 0:e.disableAutoFlushOnDocumentHide)!==!0&&"undefined"!=typeof document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush()},this._pageHideListener=function(){t.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(p)},69700:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var n=r(14515),i=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:n.i.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}()},72544:(e,t,r)=>{"use strict";r.d(t,{f:()=>i});var n=r(14515),i=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:n.i.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}()},62207:(e,t,r)=>{"use strict";r.d(t,{e:()=>l});var n=r(7353),i=r(71664),o=r(14138),s=r(30675),a=r(69700),u=r(72544),l=function(){function e(e){var t,r,n,i;this._root=e.root,this._root||((0,s.s)(Error("ParentBasedSampler must have a root sampler configured")),this._root=new u.f),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new u.f,this._remoteParentNotSampled=null!==(r=e.remoteParentNotSampled)&&void 0!==r?r:new a.t,this._localParentSampled=null!==(n=e.localParentSampled)&&void 0!==n?n:new u.f,this._localParentNotSampled=null!==(i=e.localParentNotSampled)&&void 0!==i?i:new a.t}return e.prototype.shouldSample=function(e,t,r,s,a,u){var l=n.u.getSpanContext(e);return l&&(0,i.YA)(l)?l.isRemote?l.traceFlags&o.X.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,s,a,u):this._remoteParentNotSampled.shouldSample(e,t,r,s,a,u):l.traceFlags&o.X.SAMPLED?this._localParentSampled.shouldSample(e,t,r,s,a,u):this._localParentNotSampled.shouldSample(e,t,r,s,a,u):this._root.shouldSample(e,t,r,s,a,u)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}()},84992:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});var n=r(71664),i=r(14515),o=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:(0,n.hX)(t)&&this._accumulate(t)<this._upperBound?i.i.RECORD_AND_SAMPLED:i.i.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,r=0;r<e.length/8;r++){var n=8*r;t=(t^parseInt(e.slice(n,n+8),16))>>>0}return t},e}()},26408:(e,t,r)=>{"use strict";r.d(t,{Z:()=>$});var n,i=r(2339),o=r(7353),s=r(33835),a=r(46922),u=r(8045),l=r(23202),c=r(22532),E=r(27834),p=r(48698),d=r(35684),f=r(67177),_=r(51244),h=r(22951),g=r(14138),v=r(65890),I=r(95497),T=r(45185),O=r(88705),y=r(41437),N=r(51457),A=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},R=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},m=function(){function e(e,t,r,n,i,o,s,a,u){void 0===s&&(s=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:T.s.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=n,this.parentSpanId=o,this.kind=i,this.links=s;var l=Date.now();this._performanceStartTime=O.u.now(),this._performanceOffset=l-(this._performanceStartTime+(0,y.uc)()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:l),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()||(0===e.length?i.s.warn("Invalid attribute key: "+e):(0,I.m)(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?this._droppedAttributesCount++:this.attributes[e]=this._truncateToSize(t):i.s.warn("Invalid attribute value set for key: "+e)),this},e.prototype.setAttributes=function(e){var t,r;try{for(var n=A(Object.entries(e)),i=n.next();!i.done;i=n.next()){var o=R(i.value,2),s=o[0],a=o[1];this.setAttribute(s,a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,r){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return i.s.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(i.s.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),(0,y.Ir)(t)&&((0,y.Ir)(r)||(r=t),t=void 0);var n=(0,I.L)(t);return this.events.push({name:e,attributes:n,time:this._getTime(r),droppedAttributesCount:0}),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=e),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){if(this._isSpanEnded()){i.s.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=(0,y.W5)(this.startTime,this.endTime),this._duration[0]<0&&(i.s.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this)},e.prototype._getTime=function(e){if("number"==typeof e&&e<O.u.now())return(0,y._5)(e+this._performanceOffset);if("number"==typeof e)return(0,y.lg)(e);if(e instanceof Date)return(0,y.lg)(e.getTime());if((0,y.VL)(e))return e;if(this._startTimeProvided)return(0,y.lg)(Date.now());var t=O.u.now()-this._performanceStartTime;return(0,y.mw)(this.startTime,(0,y.lg)(t))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){var r={};"string"==typeof e?r[N.IX.EXCEPTION_MESSAGE]=e:e&&(e.code?r[N.IX.EXCEPTION_TYPE]=e.code.toString():e.name&&(r[N.IX.EXCEPTION_TYPE]=e.name),e.message&&(r[N.IX.EXCEPTION_MESSAGE]=e.message),e.stack&&(r[N.IX.EXCEPTION_STACKTRACE]=e.stack)),r[N.IX.EXCEPTION_TYPE]||r[N.IX.EXCEPTION_MESSAGE]?this.addEvent("exception",r,t):i.s.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&i.s.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substr(0,t)},e.prototype._truncateToSize=function(e){var t=this,r=this._attributeValueLengthLimit;return r<=0?(i.s.warn("Attribute value limit must be positive, got "+r),e):"string"==typeof e?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(e){return"string"==typeof e?t._truncateToLimitUtil(e,r):e}):e},e}(),S=r(6023),L=r(69700),D=r(72544),b=r(62207),C=r(84992),P=(0,l._)(),U=S.R.AlwaysOn;function M(){return{sampler:V(P),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:(0,l._)().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:(0,l._)().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:(0,l._)().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:(0,l._)().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:(0,l._)().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:(0,l._)().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:(0,l._)().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:(0,l._)().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function V(e){switch(void 0===e&&(e=(0,l._)()),e.OTEL_TRACES_SAMPLER){case S.R.AlwaysOn:return new D.f;case S.R.AlwaysOff:return new L.t;case S.R.ParentBasedAlwaysOn:return new b.e({root:new D.f});case S.R.ParentBasedAlwaysOff:return new b.e({root:new L.t});case S.R.TraceIdRatio:return new C.h(F(e));case S.R.ParentBasedTraceIdRatio:return new b.e({root:new C.h(F(e))});default:return i.s.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+U+'".'),new D.f}}function F(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return i.s.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(i.s.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to 1."),1):t<0||t>1?(i.s.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to 1."),1):t}var x=r(55733),w=function(){this.generateTraceId=k(16),this.generateSpanId=k(8)},B=Array(32);function k(e){return function(){for(var t=0;t<2*e;t++)B[t]=Math.floor(16*Math.random())+48,B[t]>=58&&(B[t]+=39);return String.fromCharCode.apply(null,B.slice(0,2*e))}}var G=function(){function e(e,t,r){this._tracerProvider=r;var n,i,o,s=(n={sampler:V()},(o=Object.assign({},i=M(),n,t)).generalLimits=Object.assign({},i.generalLimits,t.generalLimits||{}),o.spanLimits=Object.assign({},i.spanLimits,t.spanLimits||{}),o);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=t.idGenerator||new w,this.resource=r.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=s._.active()),t.root&&(r=o.u.deleteSpan(r));var n,a,u,l,c,E,p=o.u.getSpan(r);if((0,v.Zf)(r)){i.s.debug("Instrumentation suppressed, returning Noop Span");var d=o.u.wrapSpanContext(f.dM);return d}var T=null==p?void 0:p.spanContext(),O=this._idGenerator.generateSpanId();T&&o.u.isSpanContextValid(T)?(l=T.traceId,c=T.traceState,E=T.spanId):l=this._idGenerator.generateTraceId();var y=null!==(n=t.kind)&&void 0!==n?n:_.v.INTERNAL,N=(null!==(a=t.links)&&void 0!==a?a:[]).map(function(e){return{context:e.context,attributes:(0,I.L)(e.attributes)}}),A=(0,I.L)(t.attributes),R=this._sampler.shouldSample(r,l,e,y,A,N);c=null!==(u=R.traceState)&&void 0!==u?u:c;var S={traceId:l,spanId:O,traceFlags:R.decision===h.i.RECORD_AND_SAMPLED?g.X.SAMPLED:g.X.NONE,traceState:c};if(R.decision===h.i.NOT_RECORD){i.s.debug("Recording is off, propagating context in a non-recording span");var d=o.u.wrapSpanContext(S);return d}var L=new m(this,r,e,S,y,E,N,t.startTime),D=(0,I.L)(Object.assign(A,R.attributes));return L.setAttributes(D),L},e.prototype.startActiveSpan=function(e,t,r,n){if(!(arguments.length<2)){2==arguments.length?u=t:3==arguments.length?(i=t,u=r):(i=t,a=r,u=n);var i,a,u,l=null!=a?a:s._.active(),c=this.startSpan(e,i,l),E=o.u.setSpan(l,c);return s._.with(E,u,void 0,c)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}(),K=r(30675),j=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,r=[];try{for(var n=j(this._spanProcessors),i=n.next();!i.done;i=n.next()){var o=i.value;r.push(o.forceFlush())}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return new Promise(function(e){Promise.all(r).then(function(){e()}).catch(function(t){(0,K.s)(t||Error("MultiSpanProcessor: forceFlush failed")),e()})})},e.prototype.onStart=function(e,t){var r,n;try{for(var i=j(this._spanProcessors),o=i.next();!o.done;o=i.next())o.value.onStart(e,t)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.onEnd=function(e){var t,r;try{for(var n=j(this._spanProcessors),i=n.next();!i.done;i=n.next())i.value.onEnd(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,r=[];try{for(var n=j(this._spanProcessors),i=n.next();!i.done;i=n.next()){var o=i.value;r.push(o.shutdown())}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return new Promise(function(e,t){Promise.all(r).then(function(){e()},t)})},e}(),H=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}(),X=r(61055);!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(n||(n={}));var z=function(){function e(e){void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var t,r,n,i,o,s,a,l,c,E,p,f,_,h,g,v,I=(0,u.h)({},M(),(h=Object.assign({},(t=e).spanLimits),g=(0,x.wn)(),h.attributeCountLimit=null!==(a=null!==(s=null!==(o=null!==(n=null===(r=t.spanLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==n?n:null===(i=t.generalLimits)||void 0===i?void 0:i.attributeCountLimit)&&void 0!==o?o:g.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:g.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==a?a:x.fv,h.attributeValueLengthLimit=null!==(_=null!==(f=null!==(p=null!==(c=null===(l=t.spanLimits)||void 0===l?void 0:l.attributeValueLengthLimit)&&void 0!==c?c:null===(E=t.generalLimits)||void 0===E?void 0:E.attributeValueLengthLimit)&&void 0!==p?p:g.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==f?f:g.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==_?_:x.aE,Object.assign({},t,{spanLimits:h})));this.resource=null!==(v=I.resource)&&void 0!==v?v:d.F.empty(),this.resource=d.F.default().merge(this.resource),this._config=Object.assign({},I,{resource:this.resource});var T=this._buildExporterFromEnv();if(void 0!==T){var O=new X.J(T);this.activeSpanProcessor=O}else this.activeSpanProcessor=new H}return e.prototype.getTracer=function(e,t,r){var n=e+"@"+(t||"")+":"+((null==r?void 0:r.schemaUrl)||"");return this._tracers.has(n)||this._tracers.set(n,new G({name:e,version:t,schemaUrl:null==r?void 0:r.schemaUrl},this._config,this)),this._tracers.get(n)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch(function(e){return i.s.error("Error while trying to shutdown current span processor",e)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new Y(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),o.u.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&s._.setGlobalContextManager(e.contextManager),e.propagator&&a.$.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map(function(t){return new Promise(function(r){var i,o=setTimeout(function(){r(Error("Span processor did not completed within timeout period of "+e+" ms")),i=n.timeout},e);t.forceFlush().then(function(){clearTimeout(o),i!==n.timeout&&r(i=n.resolved)}).catch(function(e){clearTimeout(o),i=n.error,r(e)})})});return new Promise(function(e,r){Promise.all(t).then(function(t){var i=t.filter(function(e){return e!==n.resolved});i.length>0?r(i):e()}).catch(function(e){return r([e])})})},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set((0,l._)().OTEL_PROPAGATORS)),r=t.map(function(t){var r=e._getPropagator(t);return r||i.s.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),r}).reduce(function(e,t){return t&&e.push(t),e},[]);return 0===r.length?void 0:1===t.length?r[0]:new c.n({propagators:r})},e.prototype._buildExporterFromEnv=function(){var e=(0,l._)().OTEL_TRACES_EXPORTER;if("none"!==e&&""!==e){var t=this._getSpanExporter(e);return t||i.s.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new E.lm}],["baggage",function(){return new p.t}]]),e._registeredExporters=new Map,e}(),q=r(98902),W=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},J=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},Z=function(){function e(){this._enabled=!1,this._currentContext=q.l}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=q.l);var r=this,n=function(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r.with(e,function(){return t.apply(n,i)})};return Object.defineProperty(n,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),n},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return(void 0===e&&(e=this.active()),"function"==typeof t)?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=q.l,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=q.l),this},e.prototype.with=function(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];var o=this._currentContext;this._currentContext=e||q.l;try{return t.call.apply(t,J([r],W(n),!1))}finally{this._currentContext=o}},e}(),Q=function(){var e=function(t,r){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$=function(e){function t(t){void 0===t&&(t={});var r=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return r}return Q(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new Z),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(z)},37783:(e,t,r)=>{"use strict";var n;r.d(t,{D:()=>n}),function(e){e.CONNECT_END="connectEnd",e.CONNECT_START="connectStart",e.DECODED_BODY_SIZE="decodedBodySize",e.DOM_COMPLETE="domComplete",e.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",e.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",e.DOM_INTERACTIVE="domInteractive",e.DOMAIN_LOOKUP_END="domainLookupEnd",e.DOMAIN_LOOKUP_START="domainLookupStart",e.ENCODED_BODY_SIZE="encodedBodySize",e.FETCH_START="fetchStart",e.LOAD_EVENT_END="loadEventEnd",e.LOAD_EVENT_START="loadEventStart",e.NAVIGATION_START="navigationStart",e.REDIRECT_END="redirectEnd",e.REDIRECT_START="redirectStart",e.REQUEST_START="requestStart",e.RESPONSE_END="responseEnd",e.RESPONSE_START="responseStart",e.SECURE_CONNECTION_START="secureConnectionStart",e.UNLOAD_EVENT_END="unloadEventEnd",e.UNLOAD_EVENT_START="unloadEventStart"}(n||(n={}))},30583:(e,t,r)=>{"use strict";r.d(t,{Dl:()=>E,hZ:()=>c,v4:()=>l,wF:()=>p});var n,i=r(37783),o=r(41437),s=r(4905),a=r(51457);function u(e,t,r){if(t in r&&"number"==typeof r[t])return e.addEvent(t,r[t]),e}function l(e,t){u(e,i.D.FETCH_START,t),u(e,i.D.DOMAIN_LOOKUP_START,t),u(e,i.D.DOMAIN_LOOKUP_END,t),u(e,i.D.CONNECT_START,t),"name"in t&&t.name.startsWith("https:")&&u(e,i.D.SECURE_CONNECTION_START,t),u(e,i.D.CONNECT_END,t),u(e,i.D.REQUEST_START,t),u(e,i.D.RESPONSE_START,t),u(e,i.D.RESPONSE_END,t);var r=t[i.D.ENCODED_BODY_SIZE];void 0!==r&&e.setAttribute(a.IX.HTTP_RESPONSE_CONTENT_LENGTH,r);var n=t[i.D.DECODED_BODY_SIZE];void 0!==n&&r!==n&&e.setAttribute(a.IX.HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED,n)}function c(e,t,r,n,s,a){void 0===s&&(s=new WeakSet);var u,l,c,p,d,f=E(e),_=(u=e=f.toString(),l=s,c=(0,o.u5)(t),p=(0,o.u5)(r),(d=n.filter(function(e){var t=(0,o.u5)((0,o.KJ)(e[i.D.FETCH_START])),r=(0,o.u5)((0,o.KJ)(e[i.D.RESPONSE_END]));return e.initiatorType.toLowerCase()===(a||"xmlhttprequest")&&e.name===u&&t>=c&&r<=p})).length>0&&(d=d.filter(function(e){return!l.has(e)})),d);if(0===_.length)return{mainRequest:void 0};if(1===_.length)return{mainRequest:_[0]};var h=_.slice().sort(function(e,t){var r=e[i.D.FETCH_START],n=t[i.D.FETCH_START];return r>n?1:r<n?-1:0});if(f.origin===location.origin||!(h.length>1))return{mainRequest:_[0]};var g=h[0],v=function(e,t,r){for(var n,s=(0,o.u5)(r),a=(0,o.u5)((0,o.KJ)(t)),u=e[1],l=e.length,c=1;c<l;c++){var E=e[c],p=(0,o.u5)((0,o.KJ)(E[i.D.FETCH_START])),d=s-(0,o.u5)((0,o.KJ)(E[i.D.RESPONSE_END]));p>=a&&(!n||d<n)&&(n=d,u=E)}return u}(h,g[i.D.RESPONSE_END],r),I=g[i.D.RESPONSE_END];return v[i.D.FETCH_START]<I&&(v=g,g=void 0),{corsPreFlightRequest:g,mainRequest:v}}function E(e){if("function"==typeof URL)return new URL(e,"undefined"!=typeof document?document.baseURI:"undefined"!=typeof location?location.href:void 0);var t=(n||(n=document.createElement("a")),n);return t.href=e,t}function p(e,t){var r=t||[];return("string"==typeof r||r instanceof RegExp)&&(r=[r]),E(e).origin===location.origin||r.some(function(t){return(0,s.f)(e,t)})}},42152:(e,t,r)=>{"use strict";r.d(t,{_2:()=>n,wP:()=>i});var n={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},i={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"}},51457:(e,t,r)=>{"use strict";r.d(t,{IX:()=>n});var n={AWS_LAMBDA_INVOKED_ARN:"aws.lambda.invoked_arn",DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",NET_HOST_CONNECTION_TYPE:"net.host.connection.type",NET_HOST_CONNECTION_SUBTYPE:"net.host.connection.subtype",NET_HOST_CARRIER_NAME:"net.host.carrier.name",NET_HOST_CARRIER_MCC:"net.host.carrier.mcc",NET_HOST_CARRIER_MNC:"net.host.carrier.mnc",NET_HOST_CARRIER_ICC:"net.host.carrier.icc",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_CONSUMER_ID:"messaging.consumer_id",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message",MESSAGE_TYPE:"message.type",MESSAGE_ID:"message.id",MESSAGE_COMPRESSED_SIZE:"message.compressed_size",MESSAGE_UNCOMPRESSED_SIZE:"message.uncompressed_size"}},80020:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22400),i=function(){function e(){this.errorCount=0}return e.prototype.getDelay=function(){return 0===this.errorCount?0:1e3*n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)]+Math.round(1e3*Math.random())},e.prototype.countError=function(){this.errorCount<n.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},e.prototype.reset=function(){this.errorCount=0},e}();t.default=i},22419:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(98811),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.makeGetRequest=function(e,t){return s.makeGetRequest(e,t)},t.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},t}(o(r(33626)).default);t.default=a},98811:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22400),i=r(87185).getLogger("DatafileManager");t.makeGetRequest=function(e,t){var r=new XMLHttpRequest;return{responsePromise:new Promise(function(o,s){r.open("GET",e,!0),function(e,t){Object.keys(e).forEach(function(r){var n=e[r];t.setRequestHeader(r,n)})}(t,r),r.onreadystatechange=function(){if(4===r.readyState){if(0===r.status){s(Error("Request error"));return}var e=function(e){var t=e.getAllResponseHeaders();if(null===t)return{};var r=t.split("\r\n"),n={};return r.forEach(function(e){var t=e.indexOf(": ");if(t>-1){var r=e.slice(0,t),i=e.slice(t+2);i.length>0&&(n[r]=i)}}),n}(r);o({statusCode:r.status,body:r.responseText,headers:e})}},r.timeout=n.REQUEST_TIMEOUT_MS,r.ontimeout=function(){i.error("Request timed out")},r.send()}),abort:function(){r.abort()}}}},22400:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_UPDATE_INTERVAL=3e5,t.MIN_UPDATE_INTERVAL=1e3,t.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",t.DEFAULT_AUTHENTICATED_URL_TEMPLATE="https://config.optimizely.com/datafiles/auth/%s.json",t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],t.REQUEST_TIMEOUT_MS=6e4},74648:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.listeners={},this.listenerId=1}return e.prototype.on=function(e,t){var r=this;this.listeners[e]||(this.listeners[e]={});var n=String(this.listenerId);return this.listenerId++,this.listeners[e][n]=t,function(){r.listeners[e]&&delete r.listeners[e][n]}},e.prototype.emit=function(e,t){var r=this.listeners[e];r&&Object.keys(r).forEach(function(e){(0,r[e])(t)})},e.prototype.removeAllListeners=function(){this.listeners={}},e}();t.default=r},33626:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(87185),s=r(18437),a=i(r(74648)),u=r(22400),l=i(r(80020)),c=o.getLogger("DatafileManager");function E(e){return e>=200&&e<400}var p={get:function(){return Promise.resolve("")},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},d=function(){function e(e){var t=this,r=n({},this.getConfigDefaults(),e),i=r.datafile,o=r.autoUpdate,E=r.sdkKey,d=r.updateInterval,f=void 0===d?u.DEFAULT_UPDATE_INTERVAL:d,_=r.urlTemplate,h=void 0===_?u.DEFAULT_URL_TEMPLATE:_,g=r.cache;(this.cache=void 0===g?p:g,this.cacheKey="opt-datafile-"+E,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(e,r){t.readyPromiseResolver=e,t.readyPromiseRejecter=r}),i?(this.currentDatafile=i,E||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=s.sprintf(h,E),this.emitter=new a.default,this.autoUpdate=void 0!==o&&o,f>=u.MIN_UPDATE_INTERVAL)?this.updateInterval=f:(c.warn("Invalid updateInterval %s, defaulting to %s",f,u.DEFAULT_UPDATE_INTERVAL),this.updateInterval=u.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new l.default,this.syncOnCurrentRequestComplete=!1}return e.prototype.get=function(){return this.currentDatafile},e.prototype.start=function(){this.isStarted||(c.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},e.prototype.stop=function(){return c.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},e.prototype.onReady=function(){return this.readyPromise},e.prototype.on=function(e,t){return this.emitter.on(e,t)},e.prototype.onRequestRejected=function(e){this.isStarted&&(this.backoffController.countError(),e instanceof Error?c.error("Error fetching datafile: %s",e.message,e):"string"==typeof e?c.error("Error fetching datafile: %s",e):c.error("Error fetching datafile"))},e.prototype.onRequestResolved=function(e){if(this.isStarted){void 0!==e.statusCode&&E(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var t=this.getNextDatafileFromResponse(e);""!==t&&(c.info("Updating datafile from response"),this.currentDatafile=t,this.cache.set(this.cacheKey,t),this.isReadyPromiseSettled?this.emitter.emit("update",{datafile:t}):this.resolveReadyPromise())}},e.prototype.onRequestComplete=function(){this.isStarted&&(this.currentRequest=null,this.isReadyPromiseSettled||this.autoUpdate||this.rejectReadyPromise(Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},e.prototype.syncDatafile=function(){var e=this,t={};this.lastResponseLastModified&&(t["if-modified-since"]=this.lastResponseLastModified),c.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(t)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,t);var r=function(){e.onRequestComplete()};this.currentRequest.responsePromise.then(function(t){e.onRequestResolved(t)},function(t){e.onRequestRejected(t)}).then(r,r),this.autoUpdate&&this.scheduleNextUpdate()},e.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},e.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},e.prototype.scheduleNextUpdate=function(){var e=this,t=Math.max(this.backoffController.getDelay(),this.updateInterval);c.debug("Scheduling sync in %s ms",t),this.currentTimeout=setTimeout(function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()},t)},e.prototype.getNextDatafileFromResponse=function(e){return(c.debug("Response status code: %s",e.statusCode),void 0===e.statusCode||304===e.statusCode)?"":E(e.statusCode)?e.body:""},e.prototype.trySavingLastModified=function(e){var t=e["last-modified"]||e["Last-Modified"];void 0!==t&&(this.lastResponseLastModified=t,c.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},e.prototype.setDatafileFromCacheIfAvailable=function(){var e=this;this.cache.get(this.cacheKey).then(function(t){e.isStarted&&!e.isReadyPromiseSettled&&""!==t&&(c.debug("Using datafile from cache"),e.currentDatafile=t,e.resolveReadyPromise())})},e}();t.default=d},77506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22419);t.HttpPollingDatafileManager=n.default},94068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},13301:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventNotification=t.getQueue=t.validateAndGetBatchSize=t.validateAndGetFlushInterval=t.DEFAULT_BATCH_SIZE=t.DEFAULT_FLUSH_INTERVAL=void 0;var n=r(30682),i=r(87185),o=r(18437);t.DEFAULT_FLUSH_INTERVAL=3e4,t.DEFAULT_BATCH_SIZE=10;var s=i.getLogger("EventProcessor");t.validateAndGetFlushInterval=function(e){return e<=0&&(s.warn("Invalid flushInterval "+e+", defaulting to "+t.DEFAULT_FLUSH_INTERVAL),e=t.DEFAULT_FLUSH_INTERVAL),e},t.validateAndGetBatchSize=function(e){return(e=Math.floor(e))<1&&(s.warn("Invalid batchSize "+e+", defaulting to "+t.DEFAULT_BATCH_SIZE),e=t.DEFAULT_BATCH_SIZE),e=Math.max(1,e)},t.getQueue=function(e,t,r,i){return e>1?new n.DefaultEventQueue({flushInterval:t,maxQueueSize:e,sink:r,batchComparator:i}):new n.SingleEventQueue({sink:r})},t.sendEventNotification=function(e,t){e&&e.sendNotifications(o.NOTIFICATION_TYPES.LOG_EVENT,t)}},30682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultEventQueue=t.SingleEventQueue=void 0;var n=r(87185).getLogger("EventProcessor"),i=function(){function e(e){var t=e.timeout,r=e.callback;this.timeout=Math.max(t,0),this.callback=r}return e.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},e.prototype.refresh=function(){this.stop(),this.start()},e.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},e}(),o=function(){function e(e){var t=e.sink;this.sink=t}return e.prototype.start=function(){},e.prototype.stop=function(){return Promise.resolve()},e.prototype.enqueue=function(e){this.sink([e])},e}();t.SingleEventQueue=o;var s=function(){function e(e){var t=e.flushInterval,r=e.maxQueueSize,n=e.sink,o=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(r,1),this.sink=n,this.batchComparator=o,this.timer=new i({callback:this.flush.bind(this),timeout:t}),this.started=!1}return e.prototype.start=function(){this.started=!0},e.prototype.stop=function(){this.started=!1;var e=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},e.prototype.enqueue=function(e){if(!this.started){n.warn("Queue is stopped, not accepting event");return}var t=this.buffer[0];t&&!this.batchComparator(t,e)&&this.flush(),0===this.buffer.length&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()},e.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},e}();t.DefaultEventQueue=s},90220:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areEventContextsEqual=void 0,t.areEventContextsEqual=function(e,t){var r=e.context,n=t.context;return r.accountId===n.accountId&&r.projectId===n.projectId&&r.clientName===n.clientName&&r.clientVersion===n.clientVersion&&r.revision===n.revision&&r.anonymizeIP===n.anonymizeIP&&r.botFiltering===n.botFiltering}},83969:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(90220),t),i(r(13301),t),i(r(94068),t),i(r(78556),t),i(r(38986),t),i(r(82914),t),i(r(29022),t)},78556:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},38986:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStoragePendingEventsDispatcher=t.PendingEventsDispatcher=void 0;var o=r(87185),s=r(96270),a=r(18437),u=o.getLogger("EventProcessor"),l=function(){function e(e){var t=e.eventDispatcher,r=e.store;this.dispatcher=t,this.store=r}return e.prototype.dispatchEvent=function(e,t){this.send({uuid:a.generateUUID(),timestamp:a.getTimestamp(),request:e},t)},e.prototype.sendPendingEvents=function(){var e=this,t=this.store.values();u.debug("Sending %s pending events from previous page",t.length),t.forEach(function(t){try{e.send(t,function(){})}catch(e){}})},e.prototype.send=function(e,t){var r=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,function(n){r.store.remove(e.uuid),t(n)})},e}();t.PendingEventsDispatcher=l;var c=function(e){function t(t){var r=t.eventDispatcher;return e.call(this,{eventDispatcher:r,store:new s.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return i(t,e),t}(l);t.LocalStoragePendingEventsDispatcher=c},96270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageStore=void 0;var n=r(18437),i=r(87185).getLogger("EventProcessor"),o=function(){function e(e){var t=e.key,r=e.maxValues;this.LS_KEY=t,this.maxValues=void 0===r?1e3:r}return e.prototype.get=function(e){return this.getMap()[e]||null},e.prototype.set=function(e,t){var r=this.getMap();r[e]=t,this.replace(r)},e.prototype.remove=function(e){var t=this.getMap();delete t[e],this.replace(t)},e.prototype.values=function(){return n.objectValues(this.getMap())},e.prototype.clear=function(){this.replace({})},e.prototype.replace=function(e){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(e){i.error(e)}},e.prototype.clean=function(){var e=this.getMap(),t=Object.keys(e),r=t.length-this.maxValues;if(!(r<1)){var n=t.map(function(t){return{key:t,value:e[t]}});n.sort(function(e,t){return e.value.timestamp-t.value.timestamp});for(var i=0;i<r;i++)delete e[n[i].key];this.replace(e)}},e.prototype.getMap=function(){try{var e=window.localStorage&&localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(e){i.error(e)}return{}},e}();t.LocalStorageStore=o},63298:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return e.prototype.trackRequest=function(e){var t=this;this.reqsInFlightCount++;var r=function(){t.reqsInFlightCount--,0===t.reqsInFlightCount&&(t.reqsCompleteResolvers.forEach(function(e){return e()}),t.reqsCompleteResolvers=[])};e.then(r,r)},e.prototype.onRequestsComplete=function(){var e=this;return new Promise(function(t){0===e.reqsInFlightCount?t():e.reqsCompleteResolvers.push(t)})},e}();t.default=r},82914:function(e,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.formatEvents=t.buildConversionEventV1=t.buildImpressionEventV1=t.makeBatchedEventV1=void 0;var n="$opt_bot_filtering";function i(e){var t=[],r=e[0];return e.forEach(function(e){if("conversion"===e.type||"impression"===e.type){var r=a(e);"impression"===e.type?r.snapshots.push(s(e)):"conversion"===e.type&&r.snapshots.push(o(e)),t.push(r)}}),{client_name:r.context.clientName,client_version:r.context.clientVersion,account_id:r.context.accountId,project_id:r.context.projectId,revision:r.context.revision,anonymize_ip:r.context.anonymizeIP,enrich_decisions:!0,visitors:t}}function o(e){var t=r({},e.tags);delete t.revenue,delete t.value;var n={entity_id:e.event.id,key:e.event.key,timestamp:e.timestamp,uuid:e.uuid};return e.tags&&(n.tags=e.tags),null!=e.value&&(n.value=e.value),null!=e.revenue&&(n.revenue=e.revenue),{events:[n]}}function s(e){var t=e.layer,r=e.experiment,n=e.variation,i=e.ruleKey,o=e.flagKey,s=e.ruleType,a=e.enabled,u=t?t.id:null;return{decisions:[{campaign_id:u,experiment_id:r?r.id:null,variation_id:n?n.id:null,metadata:{flag_key:o,rule_key:i,rule_type:s,variation_key:n?n.key:"",enabled:a}}],events:[{entity_id:u,timestamp:e.timestamp,key:"campaign_activated",uuid:e.uuid}]}}function a(e){var t={snapshots:[],visitor_id:e.user.id,attributes:[]};return e.user.attributes.forEach(function(e){t.attributes.push({entity_id:e.entityId,key:e.key,type:"custom",value:e.value})}),"boolean"==typeof e.context.botFiltering&&t.attributes.push({entity_id:n,key:n,type:"custom",value:e.context.botFiltering}),t}t.makeBatchedEventV1=i,t.buildImpressionEventV1=function(e){var t=a(e);return t.snapshots.push(s(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.buildConversionEventV1=function(e){var t=a(e);return t.snapshots.push(o(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.formatEvents=function(e){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:i(e)}}},29022:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogTierV1EventProcessor=void 0;var s=r(87185),a=r(13301),u=o(r(63298)),l=r(90220),c=r(82914),E=s.getLogger("LogTierV1EventProcessor"),p=function(){function e(e){var t=e.dispatcher,r=e.flushInterval,n=void 0===r?a.DEFAULT_FLUSH_INTERVAL:r,i=e.batchSize,o=void 0===i?a.DEFAULT_BATCH_SIZE:i,s=e.notificationCenter;this.dispatcher=t,this.notificationCenter=s,this.requestTracker=new u.default,n=a.validateAndGetFlushInterval(n),o=a.validateAndGetBatchSize(o),this.queue=a.getQueue(o,n,this.drainQueue.bind(this),l.areEventContextsEqual)}return e.prototype.drainQueue=function(e){var t=this,r=new Promise(function(r){if(E.debug("draining queue with %s events",e.length),0===e.length){r();return}var n=c.formatEvents(e);t.dispatcher.dispatchEvent(n,function(){r()}),a.sendEventNotification(t.notificationCenter,n)});return this.requestTracker.trackRequest(r),r},e.prototype.process=function(e){this.queue.enqueue(e)},e.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){E.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},e.prototype.start=function(){return n(this,void 0,void 0,function(){return i(this,function(e){return this.queue.start(),[2]})})},e}();t.LogTierV1EventProcessor=p},17847:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.handleError=function(e){},e}();t.NoopErrorHandler=r;var n=new r;t.setErrorHandler=function(e){n=e},t.getErrorHandler=function(){return n},t.resetErrorHandler=function(){n=new r}},87185:(e,t,r)=>{"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(17847)),n(r(64739)),n(r(74609))},74609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17847),i=r(46790),o=r(64739),s={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function a(e){return"string"!=typeof e?e:("WARN"===(e=e.toUpperCase())&&(e="WARNING"),s[e])?s[e]:e}var u=function(){function e(){this.defaultLoggerFacade=new p,this.loggers={}}return e.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new p({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},e}(),l=function(){function e(e){void 0===e&&(e={}),this.logLevel=o.LogLevel.NOTSET,void 0!==e.logLevel&&i.isValidEnum(o.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=void 0===e.logToConsole||!!e.logToConsole,this.prefix=void 0!==e.prefix?e.prefix:"[OPTIMIZELY]"}return e.prototype.log=function(e,t){if(this.shouldLog(e)&&this.logToConsole){var r=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+t;this.consoleLog(e,[r])}},e.prototype.setLogLevel=function(e){e=a(e),i.isValidEnum(o.LogLevel,e)&&void 0!==e?this.logLevel=e:this.logLevel=o.LogLevel.ERROR},e.prototype.getTime=function(){return new Date().toISOString()},e.prototype.shouldLog=function(e){return e>=this.logLevel},e.prototype.getLogLevelName=function(e){switch(e){case o.LogLevel.DEBUG:return"DEBUG";case o.LogLevel.INFO:return"INFO ";case o.LogLevel.WARNING:return"WARN ";case o.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},e.prototype.consoleLog=function(e,t){switch(e){case o.LogLevel.DEBUG:console.log.apply(console,t);break;case o.LogLevel.INFO:console.info.apply(console,t);break;case o.LogLevel.WARNING:console.warn.apply(console,t);break;case o.LogLevel.ERROR:console.error.apply(console,t);break;default:console.log.apply(console,t)}},e}();t.ConsoleLogHandler=l;var c=o.LogLevel.NOTSET,E=null,p=function(){function e(e){void 0===e&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return e.prototype.log=function(e,t){this.internalLog(a(e),{message:t,splat:[]})},e.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.INFO,e,t)},e.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.DEBUG,e,t)},e.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.WARNING,e,t)},e.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.ERROR,e,t)},e.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+i.sprintf.apply(void 0,[e.message].concat(e.splat))},e.prototype.internalLog=function(e,t){E&&!(e<c)&&(E.log(e,this.format(t)),t.error&&t.error instanceof Error&&n.getErrorHandler().handleError(t.error))},e.prototype.namedLog=function(e,t,r){if(t instanceof Error){t=(n=t).message,this.internalLog(e,{error:n,message:t,splat:r});return}if(0===r.length){this.internalLog(e,{message:t,splat:r});return}var n,i=r[r.length-1];i instanceof Error&&(n=i,r.splice(-1)),this.internalLog(e,{message:t,error:n,splat:r})},e}(),d=new u;t.getLogger=function(e){return d.getLogger(e)},t.setLogHandler=function(e){E=e},t.setLogLevel=function(e){e=a(e),c=i.isValidEnum(o.LogLevel,e)&&void 0!==e?e:o.LogLevel.ERROR},t.getLogLevel=function(){return c},t.resetLogger=function(){d=new u,c=o.LogLevel.NOTSET}},64739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NOTSET=0]="NOTSET",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR"}(t.LogLevel||(t.LogLevel={}))},46790:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(14802);function i(e){return Object.keys(e).map(function(t){return e[t]})}t.getTimestamp=function(){return new Date().getTime()},t.generateUUID=function(){return n.v4()},t.isValidEnum=function(e,t){for(var r=!1,n=Object.keys(e),i=0;i<n.length;i++)if(t===e[n[i]]){r=!0;break}return r},t.groupBy=function(e,t){var r={};return e.forEach(function(e){var n=t(e);r[n]=r[n]||[],r[n].push(e)}),i(r)},t.objectValues=i,t.find=function(e,t){for(var r,n=0;n<e.length;n++){var i=e[n];if(t(i)){r=i;break}}return r},t.keyBy=function(e,t){var r={};return e.forEach(function(e){r[t(e)]=e}),r},t.sprintf=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=0;return e.replace(/%s/g,function(){var e=t[n++],r=typeof e;return"function"===r?e():"string"===r?e:String(e)})}},14802:(e,t,r)=>{var n=r(53509),i=r(86285);i.v1=n,i.v4=i,e.exports=i},34571:e=>{for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0;return[t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]]].join("")}},81442:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=Array(16);e.exports=function(){for(var e,t=0;t<16;t++)(3&t)==0&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},53509:(e,t,r)=>{var n,i,o=r(81442),s=r(34571),a=0,u=0;e.exports=function(e,t,r){var l=t&&r||0,c=t||[],E=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:i;if(null==E||null==p){var d=o();null==E&&(E=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=i=(d[6]<<8|d[7])&16383)}var f=void 0!==e.msecs?e.msecs:new Date().getTime(),_=void 0!==e.nsecs?e.nsecs:u+1,h=f-a+(_-u)/1e4;if(h<0&&void 0===e.clockseq&&(p=p+1&16383),(h<0||f>a)&&void 0===e.nsecs&&(_=0),_>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,u=_,i=p;var g=((268435455&(f+=122192928e5))*1e4+_)%4294967296;c[l++]=g>>>24&255,c[l++]=g>>>16&255,c[l++]=g>>>8&255,c[l++]=255&g;var v=f/4294967296*1e4&268435455;c[l++]=v>>>8&255,c[l++]=255&v,c[l++]=v>>>24&15|16,c[l++]=v>>>16&255,c[l++]=p>>>8|128,c[l++]=255&p;for(var I=0;I<6;++I)c[l+I]=E[I];return t||s(c)}},86285:(e,t,r)=>{var n=r(81442),i=r(34571);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},18437:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(33798);function i(e){return Object.keys(e).map(function(t){return e[t]})}t.generateUUID=function(){return n.v4()},t.getTimestamp=function(){return new Date().getTime()},t.isValidEnum=function(e,t){for(var r=!1,n=Object.keys(e),i=0;i<n.length;i++)if(t===e[n[i]]){r=!0;break}return r},t.groupBy=function(e,t){var r={};return e.forEach(function(e){var n=t(e);r[n]=r[n]||[],r[n].push(e)}),i(r)},t.objectValues=i,t.objectEntries=function(e){return Object.keys(e).map(function(t){return[t,e[t]]})},t.find=function(e,t){for(var r,n=0;n<e.length;n++){var i=e[n];if(t(i)){r=i;break}}return r},t.keyBy=function(e,t){var r={};return e.forEach(function(e){r[t(e)]=e}),r},t.sprintf=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=0;return e.replace(/%s/g,function(){var e=t[n++],r=typeof e;return"function"===r?e():"string"===r?e:String(e)})},function(e){e.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",e.DECISION="DECISION:type, userId, attributes, decisionInfo",e.LOG_EVENT="LOG_EVENT:logEvent",e.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",e.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"}(t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))},33798:(e,t,r)=>{var n=r(49265),i=r(17710);i.v1=n,i.v4=i,e.exports=i},79919:e=>{for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0;return[t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]]].join("")}},83054:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=Array(16);e.exports=function(){for(var e,t=0;t<16;t++)(3&t)==0&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},49265:(e,t,r)=>{var n,i,o=r(83054),s=r(79919),a=0,u=0;e.exports=function(e,t,r){var l=t&&r||0,c=t||[],E=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:i;if(null==E||null==p){var d=o();null==E&&(E=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=i=(d[6]<<8|d[7])&16383)}var f=void 0!==e.msecs?e.msecs:new Date().getTime(),_=void 0!==e.nsecs?e.nsecs:u+1,h=f-a+(_-u)/1e4;if(h<0&&void 0===e.clockseq&&(p=p+1&16383),(h<0||f>a)&&void 0===e.nsecs&&(_=0),_>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,u=_,i=p;var g=((268435455&(f+=122192928e5))*1e4+_)%4294967296;c[l++]=g>>>24&255,c[l++]=g>>>16&255,c[l++]=g>>>8&255,c[l++]=255&g;var v=f/4294967296*1e4&268435455;c[l++]=v>>>8&255,c[l++]=255&v,c[l++]=v>>>24&15|16,c[l++]=v>>>16&255,c[l++]=p>>>8|128,c[l++]=255&p;for(var I=0;I<6;++I)c[l+I]=E[I];return t||s(c)}},17710:(e,t,r)=>{var n=r(83054),i=r(79919);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},62492:(e,t,r)=>{"use strict";var n,i,o,s=r(87185),a=r(83969),u=r(18437),l=r(77506),c=(o=r(43784))&&"object"==typeof o&&"default"in o?o.default:o,E=function(){return(E=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}var d={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},f={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},_={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_DEFAULT_DECIDE_OPTIONS:"%s: Provided default decide options is not an array.",INVALID_DECIDE_OPTIONS:"%s: Provided decide options is not an array. Using default decide options.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",UNRECOGNIZED_DECIDE_OPTION:"%s: Unrecognized decide option %s provided.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},h={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},g=["node-sdk","react-sdk","javascript-sdk","react-native-sdk","react-native-js-sdk"],v=u.NOTIFICATION_TYPES,I={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables",FLAG:"flag"},T={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},O={RULE:"rule",EXPERIMENT:"experiment"},y={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},N={V2:"2",V3:"3",V4:"4"},A={SDK_NOT_READY:"Optimizely SDK not configured properly yet.",FLAG_KEY_INVALID:'No flag was found for key "%s".',VARIABLE_VALUE_INVALID:'Variable value for key "%s" is invalid or wrong type.'},R=Object.freeze({__proto__:null,LOG_LEVEL:d,ERROR_MESSAGES:f,LOG_MESSAGES:_,CONTROL_ATTRIBUTES:h,JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",REACT_NATIVE_CLIENT_ENGINE:"react-native-sdk",REACT_NATIVE_JS_CLIENT_ENGINE:"react-native-js-sdk",NODE_CLIENT_VERSION:"4.7.0",VALID_CLIENT_ENGINES:g,NOTIFICATION_TYPES:v,DECISION_NOTIFICATION_TYPES:I,DECISION_SOURCES:T,AUDIENCE_EVALUATION_TYPES:O,FEATURE_VARIABLE_TYPES:y,DATAFILE_VERSIONS:N,DECISION_MESSAGES:A}),m="CONFIG_VALIDATOR",S=[N.V2,N.V3,N.V4],L=function(e){if("object"==typeof e&&null!==e){var t=e.errorHandler,r=e.eventDispatcher,n=e.logger;if(t&&"function"!=typeof t.handleError)throw Error(u.sprintf(f.INVALID_ERROR_HANDLER,m));if(r&&"function"!=typeof r.dispatchEvent)throw Error(u.sprintf(f.INVALID_EVENT_DISPATCHER,m));if(n&&"function"!=typeof n.log)throw Error(u.sprintf(f.INVALID_LOGGER,m));return!0}throw Error(u.sprintf(f.INVALID_CONFIG,m))},D=function(e){if(!e)throw Error(u.sprintf(f.NO_DATAFILE_SPECIFIED,m));if("string"==typeof e)try{e=JSON.parse(e)}catch(e){throw Error(u.sprintf(f.INVALID_DATAFILE_MALFORMED,m))}if("object"==typeof e&&!Array.isArray(e)&&null!==e&&-1===S.indexOf(e.version))throw Error(u.sprintf(f.INVALID_DATAFILE_VERSION,m,e.version));return e},b={dispatchEvent:function(e,t){var r,n=e.params,i=e.url;"POST"===e.httpVerb?((r=new XMLHttpRequest).open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t({statusCode:r.status})}catch(e){}},r.send(JSON.stringify(n))):(i+="?wxhr=true",n&&(i+="&"+Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&")),(r=new XMLHttpRequest).open("GET",i,!0),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t({statusCode:r.status})}catch(e){}},r.send())}},C=function(){function e(){}return e.prototype.log=function(){},e}();function P(e){return new s.ConsoleLogHandler(e)}function U(e,t,r){return{variationKey:null,enabled:!1,variables:{},ruleKey:null,flagKey:e,userContext:t,reasons:r}}Object.freeze({__proto__:null,NoOpLogger:C,createLogger:P,createNoOpLogger:function(){return new C}}),!function(e){e.BOOLEAN="boolean",e.DOUBLE="double",e.INTEGER="integer",e.STRING="string",e.JSON="json"}(n||(n={})),(i=t.kn||(t.kn={})).DISABLE_DECISION_EVENT="DISABLE_DECISION_EVENT",i.ENABLED_FLAGS_ONLY="ENABLED_FLAGS_ONLY",i.IGNORE_USER_PROFILE_SERVICE="IGNORE_USER_PROFILE_SERVICE",i.INCLUDE_REASONS="INCLUDE_REASONS",i.EXCLUDE_VARIABLES="EXCLUDE_VARIABLES";var M=function(){function e(e){var t,r=e.optimizely,n=e.userId,i=e.attributes;this.optimizely=r,this.userId=n,this.attributes=null!==(t=E({},i))&&void 0!==t?t:{}}return e.prototype.setAttribute=function(e,t){this.attributes[e]=t},e.prototype.getUserId=function(){return this.userId},e.prototype.getAttributes=function(){return E({},this.attributes)},e.prototype.getOptimizely=function(){return this.optimizely},e.prototype.decide=function(e,t){return void 0===t&&(t=[]),this.optimizely.decide(this.cloneUserContext(),e,t)},e.prototype.decideForKeys=function(e,t){return void 0===t&&(t=[]),this.optimizely.decideForKeys(this.cloneUserContext(),e,t)},e.prototype.decideAll=function(e){return void 0===e&&(e=[]),this.optimizely.decideAll(this.cloneUserContext(),e)},e.prototype.trackEvent=function(e,t){this.optimizely.track(e,this.userId,this.attributes,t)},e.prototype.cloneUserContext=function(){return new e({optimizely:this.getOptimizely(),userId:this.getUserId(),attributes:this.getAttributes()})},e}(),V={assign:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!e)return{};if("function"==typeof Object.assign)return Object.assign.apply(Object,p([e],t));for(var n=Object(e),i=0;i<t.length;i++){var o=t[i];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n},currentTimestamp:function(){return Math.round((new Date).getTime())},isSafeInteger:function(e){return"number"==typeof e&&9007199254740992>=Math.abs(e)},keyBy:function(e,t){return e?u.keyBy(e,function(e){return e[t]}):{}},uuid:u.generateUUID,isNumber:function(e){return"number"==typeof e}},F=["and","or","not"];function x(e,t){if(Array.isArray(e)){var r=e[0],n=e.slice(1);switch("string"==typeof r&&-1===F.indexOf(r)&&(r="or",n=e),r){case"and":return function(e,t){var r=!1;if(Array.isArray(e)){for(var n=0;n<e.length;n++){var i=x(e[n],t);if(!1===i)return!1;null===i&&(r=!0)}return!r||null}return null}(n,t);case"not":return function(e,t){if(Array.isArray(e)&&e.length>0){var r=x(e[0],t);return null===r?null:!r}return null}(n,t);default:return function(e,t){var r=!1;if(Array.isArray(e)){for(var n=0;n<e.length;n++){var i=x(e[n],t);if(!0===i)return!0;null===i&&(r=!0)}return!!r&&null}return null}(n,t)}}return t(e)}var w=function(){function e(t,r){this.sdkKey=null!==(n=t.sdkKey)&&void 0!==n?n:"",this.environmentKey=null!==(i=t.environmentKey)&&void 0!==i?i:"",this.attributes=t.attributes,this.audiences=e.getAudiences(t),this.events=t.events,this.revision=t.revision;var n,i,o=(t.featureFlags||[]).reduce(function(e,t){return e[t.id]=t.variables,e},{}),s=e.getExperimentsMapById(t,o);this.experimentsMap=e.getExperimentsKeyMap(s),this.featuresMap=e.getFeaturesMap(t,o,s),this.datafile=r}return e.prototype.getDatafile=function(){return this.datafile},e.getAudiences=function(e){var t=[],r=[];return(e.typedAudiences||[]).forEach(function(e){t.push({id:e.id,conditions:JSON.stringify(e.conditions),name:e.name}),r.push(e.id)}),(e.audiences||[]).forEach(function(e){-1===r.indexOf(e.id)&&"$opt_dummy_audience"!=e.id&&t.push({id:e.id,conditions:JSON.stringify(e.conditions),name:e.name})}),t},e.getSerializedAudiences=function(t,r){var n="";if(t){var i="";t.forEach(function(t){var o="";if(t instanceof Array)o="("+(o=e.getSerializedAudiences(t,r))+")";else if(F.indexOf(t)>-1)i=t.toUpperCase();else{var s=r[t]?r[t].name:t;n||"NOT"===i?(i=""===i?"OR":i,n=""===n?i+' "'+r[t].name+'"':n.concat(" "+i+' "'+s+'"')):n='"'+s+'"'}""!==o&&(""!==n||"NOT"===i?(i=""===i?"OR":i,n=""===n?i+" "+o:n.concat(" "+i+" "+o)):n=n.concat(o))})}return n},e.getExperimentAudiences=function(t,r){return t.audienceConditions?e.getSerializedAudiences(t.audienceConditions,r.audiencesById):""},e.mergeFeatureVariables=function(e,t,r,n,i){var o=(e[r]||[]).reduce(function(e,t){return e[t.key]={id:t.id,key:t.key,type:t.type,value:t.defaultValue},e},{});return(n||[]).forEach(function(e){var r=t[e.id],n={id:e.id,key:r.key,type:r.type,value:i?e.value:r.defaultValue};o[r.key]=n}),o},e.getVariationsMap=function(t,r,n,i){return t.reduce(function(t,o){var s=e.mergeFeatureVariables(r,n,i,o.variables,o.featureEnabled);return t[o.key]={id:o.id,key:o.key,featureEnabled:o.featureEnabled,variablesMap:s},t},{})},e.getVariableIdMap=function(e){return(e.featureFlags||[]).reduce(function(e,t){return t.variables.forEach(function(t){e[t.id]=t}),e},{})},e.getDeliveryRules=function(t,r,n,i){var o=e.getVariableIdMap(t);return i.map(function(i){return{id:i.id,key:i.key,audiences:e.getExperimentAudiences(i,t),variationsMap:e.getVariationsMap(i.variations,r,o,n)}})},e.getRolloutExperimentIds=function(e){var t=[];return(e||[]).forEach(function(e){e.experiments.forEach(function(e){t.push(e.id)})}),t},e.getExperimentsMapById=function(t,r){var n=e.getVariableIdMap(t),i=this.getRolloutExperimentIds(t.rollouts);return(t.experiments||[]).reduce(function(o,s){if(-1===i.indexOf(s.id)){var a=t.experimentFeatureMap[s.id],u="";a&&a.length>0&&(u=a[0]);var l=e.getVariationsMap(s.variations,r,n,u.toString());o[s.id]={id:s.id,key:s.key,audiences:e.getExperimentAudiences(s,t),variationsMap:l}}return o},{})},e.getExperimentsKeyMap=function(e){var t={};for(var r in e){var n=e[r];t[n.key]=n}return t},e.getFeaturesMap=function(t,r,n){var i={};return t.featureFlags.forEach(function(o){var s={},a=[];o.experimentIds.forEach(function(e){var t=n[e];t&&(s[t.key]=t),a.push(n[e])});var u=(o.variables||[]).reduce(function(e,t){return e[t.key]={id:t.id,key:t.key,type:t.type,value:t.defaultValue},e},{}),l=[],c=t.rolloutIdMap[o.rolloutId];c&&(l=e.getDeliveryRules(t,r,o.id,c.experiments)),i[o.key]={id:o.id,key:o.key,experimentRules:a,deliveryRules:l,experimentsMap:s,variablesMap:u}}),i},e}(),B="PROJECT_CONFIG",k=function(e,t){void 0===t&&(t=null);var r,n,i,o=((i=V.assign({},e)).audiences=(e.audiences||[]).map(function(e){return V.assign({},e)}),i.experiments=(e.experiments||[]).map(function(e){return V.assign({},e)}),i.featureFlags=(e.featureFlags||[]).map(function(e){return V.assign({},e)}),i.groups=(e.groups||[]).map(function(e){var t=V.assign({},e);return t.experiments=(e.experiments||[]).map(function(e){return V.assign({},e)}),t}),i.rollouts=(e.rollouts||[]).map(function(e){var t=V.assign({},e);return t.experiments=(e.experiments||[]).map(function(e){return V.assign({},e)}),t}),i.environmentKey=null!==(r=e.environmentKey)&&void 0!==r?r:"",i.sdkKey=null!==(n=e.sdkKey)&&void 0!==n?n:"",i);return o.__datafileStr=null===t?JSON.stringify(e):t,(o.audiences||[]).forEach(function(e){e.conditions=JSON.parse(e.conditions)}),o.audiencesById=V.keyBy(o.audiences,"id"),V.assign(o.audiencesById,V.keyBy(o.typedAudiences,"id")),o.attributeKeyMap=V.keyBy(o.attributes,"key"),o.eventKeyMap=V.keyBy(o.events,"key"),o.groupIdMap=V.keyBy(o.groups,"id"),Object.keys(o.groupIdMap||{}).forEach(function(e){(o.groupIdMap[e].experiments||[]).forEach(function(t){o.experiments.push(V.assign(t,{groupId:e}))})}),o.rolloutIdMap=V.keyBy(o.rollouts||[],"id"),u.objectValues(o.rolloutIdMap||{}).forEach(function(e){(e.experiments||[]).forEach(function(e){o.experiments.push(e),e.variationKeyMap=V.keyBy(e.variations,"key")})}),o.experimentKeyMap=V.keyBy(o.experiments,"key"),o.experimentIdMap=V.keyBy(o.experiments,"id"),o.variationIdMap={},o.variationVariableUsageMap={},(o.experiments||[]).forEach(function(e){e.variationKeyMap=V.keyBy(e.variations,"key"),V.assign(o.variationIdMap,V.keyBy(e.variations,"id")),u.objectValues(e.variationKeyMap||{}).forEach(function(e){e.variables&&(o.variationVariableUsageMap[e.id]=V.keyBy(e.variables,"id"))})}),o.experimentFeatureMap={},o.featureKeyMap=V.keyBy(o.featureFlags||[],"key"),u.objectValues(o.featureKeyMap||{}).forEach(function(e){e.variables.forEach(function(e){e.type===y.STRING&&e.subType===y.JSON&&(e.type=y.JSON,delete e.subType)}),e.variableKeyMap=V.keyBy(e.variables,"key"),(e.experimentIds||[]).forEach(function(t){o.experimentFeatureMap[t]?o.experimentFeatureMap[t].push(e.id):o.experimentFeatureMap[t]=[e.id]})}),o},G=function(e,t){var r=e.experimentIdMap[t];if(!r)throw Error(u.sprintf(f.INVALID_EXPERIMENT_ID,B,t));return r.layerId},K=function(e,t,r){var n=e.attributeKeyMap[t],i=0===t.indexOf("$opt_");return n?(i&&r.log(d.WARNING,u.sprintf("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",t,"$opt_")),n.id):i?t:(r.log(d.DEBUG,u.sprintf(f.UNRECOGNIZED_ATTRIBUTE,B,t)),null)},j=function(e,t){var r=e.eventKeyMap[t];return r?r.id:null},Y=function(e,t){var r=e.experimentKeyMap[t];if(!r)throw Error(u.sprintf(f.INVALID_EXPERIMENT_KEY,B,t));return r.status},H=function(e,t){return e.variationIdMap.hasOwnProperty(t)?e.variationIdMap[t].key:null},X=function(e,t,r){var n=e.experimentIdMap[t];return n.variationKeyMap.hasOwnProperty(r)?n.variationKeyMap[r].id:null},z=function(e,t){if(e.experimentKeyMap.hasOwnProperty(t)){var r=e.experimentKeyMap[t];if(r)return r}throw Error(u.sprintf(f.EXPERIMENT_KEY_NOT_IN_DATAFILE,B,t))},q=function(e,t){var r=e.experimentIdMap[t];if(!r)throw Error(u.sprintf(f.INVALID_EXPERIMENT_ID,B,t));return r.trafficAllocation},W=function(e,t,r){if(e.experimentIdMap.hasOwnProperty(t)){var n=e.experimentIdMap[t];if(n)return n}return r.log(d.ERROR,u.sprintf(f.INVALID_EXPERIMENT_ID,B,t)),null},J=function(e,t,r){if(e.featureKeyMap.hasOwnProperty(t)){var n=e.featureKeyMap[t];if(n)return n}return r.log(d.ERROR,u.sprintf(f.FEATURE_NOT_IN_DATAFILE,B,t)),null},Z=function(e){return e.__datafileStr},Q=function(e){return!!e.sendFlagDecisions},$=s.getLogger();function ee(e,t){return e instanceof Error?e.message:t||"Unknown error"}var et=function(){function e(e){this.updateListeners=[],this.configObj=null,this.optimizelyConfigObj=null,this.datafileManager=null;try{if(this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){var t=Error(u.sprintf(f.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.readyPromise=Promise.resolve({success:!1,reason:ee(t)}),void $.error(t)}var r=null;if(e.datafile&&(r=this.handleNewDatafile(e.datafile)),e.sdkKey){var n={sdkKey:e.sdkKey};this.validateDatafileOptions(e.datafileOptions)&&V.assign(n,e.datafileOptions),this.configObj&&(n.datafile=Z(this.configObj)),this.datafileManager=new l.HttpPollingDatafileManager(n),this.datafileManager.start(),this.readyPromise=this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this),this.onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.onDatafileManagerUpdate.bind(this))}else this.configObj?this.readyPromise=Promise.resolve({success:!0}):this.readyPromise=Promise.resolve({success:!1,reason:ee(r,"Invalid datafile")})}catch(e){$.error(e),this.readyPromise=Promise.resolve({success:!1,reason:ee(e,"Error in initialize")})}}return e.prototype.onDatafileManagerReadyFulfill=function(){if(this.datafileManager){var e=this.handleNewDatafile(this.datafileManager.get());return e?{success:!1,reason:ee(e)}:{success:!0}}return{success:!1,reason:ee(null,"Datafile manager is not provided")}},e.prototype.onDatafileManagerReadyReject=function(e){return{success:!1,reason:ee(e,"Failed to become ready")}},e.prototype.onDatafileManagerUpdate=function(){this.datafileManager&&this.handleNewDatafile(this.datafileManager.get())},e.prototype.validateDatafileOptions=function(e){return void 0===e||"object"==typeof e&&null!==e},e.prototype.handleNewDatafile=function(e){var t=function(e){try{t=D(e.datafile)}catch(e){return{configObj:null,error:e}}if(e.jsonSchemaValidator)try{e.jsonSchemaValidator.validate(t),e.logger.log(d.INFO,u.sprintf(_.VALID_DATAFILE,B))}catch(e){return{configObj:null,error:e}}else e.logger.log(d.INFO,u.sprintf(_.SKIPPING_JSON_VALIDATION,B));var t,r=[t];return"string"==typeof e.datafile&&r.push(e.datafile),{configObj:k.apply(void 0,r),error:null}}({datafile:e,jsonSchemaValidator:this.jsonSchemaValidator,logger:$}),r=t.configObj,n=t.error;if(n)$.error(n);else{var i=this.configObj?this.configObj.revision:"null";r&&i!==r.revision&&(this.configObj=r,this.optimizelyConfigObj=new w(this.configObj,Z(this.configObj)),this.updateListeners.forEach(function(e){return e(r)}))}return n},e.prototype.getConfig=function(){return this.configObj},e.prototype.getOptimizelyConfig=function(){return this.optimizelyConfigObj},e.prototype.onReady=function(){return this.readyPromise},e.prototype.onUpdate=function(e){var t=this;return this.updateListeners.push(e),function(){var r=t.updateListeners.indexOf(e);r>-1&&t.updateListeners.splice(r,1)}},e.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.updateListeners=[]},e}(),er=function(){function e(e){var t=this;this.logger=e.logger,this.errorHandler=e.errorHandler,this.notificationListeners={},u.objectValues(v).forEach(function(e){t.notificationListeners[e]=[]}),this.listenerId=1}return e.prototype.addNotificationListener=function(e,t){try{if(!(u.objectValues(v).indexOf(e)>-1))return -1;this.notificationListeners[e]||(this.notificationListeners[e]=[]);var r=!1;if((this.notificationListeners[e]||[]).forEach(function(e){e.callback!==t||(r=!0)}),r)return -1;this.notificationListeners[e].push({id:this.listenerId,callback:t});var n=this.listenerId;return this.listenerId+=1,n}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),-1}},e.prototype.removeNotificationListener=function(e){var t,r,n=this;try{if(Object.keys(this.notificationListeners).some(function(i){return(n.notificationListeners[i]||[]).every(function(n,o){return n.id!==e||(t=o,r=i,!1)}),void 0!==t&&void 0!==r}),void 0!==t&&void 0!==r)return this.notificationListeners[r].splice(t,1),!0}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e)}return!1},e.prototype.clearAllNotificationListeners=function(){var e=this;try{u.objectValues(v).forEach(function(t){e.notificationListeners[t]=[]})}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e)}},e.prototype.clearNotificationListeners=function(e){try{this.notificationListeners[e]=[]}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e)}},e.prototype.sendNotifications=function(e,t){var r=this;try{(this.notificationListeners[e]||[]).forEach(function(n){var i=n.callback;try{i(t)}catch(t){r.logger.log(d.ERROR,u.sprintf(_.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,t.message))}})}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e)}},e}(),en=function(e){var t=[],r=e.experimentIdMap[e.experimentId].groupId;if(r){var n=e.groupIdMap[r];if(!n)throw Error(u.sprintf(f.INVALID_GROUP_ID,"BUCKETER",r));if("random"===n.policy){var i=ei(n,e.bucketingId,e.userId,e.logger);if(null===i){var o=u.sprintf(_.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",e.userId,r);return e.logger.log(d.INFO,o),t.push(o),{result:null,reasons:t}}if(i!==e.experimentId){var s=u.sprintf(_.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,r);return e.logger.log(d.INFO,s),t.push(s),{result:null,reasons:t}}var a=u.sprintf(_.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,r);e.logger.log(d.INFO,a),t.push(a)}}var l=es(u.sprintf("%s%s",e.bucketingId,e.experimentId)),c=u.sprintf(_.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",l,e.userId);e.logger.log(d.DEBUG,c),t.push(c);var E=eo(l,e.trafficAllocationConfig);if(null!==E&&!e.variationIdMap[E]){if(E){var p=u.sprintf(_.INVALID_VARIATION_ID,"BUCKETER");e.logger.log(d.WARNING,p),t.push(p)}return{result:null,reasons:t}}return{result:E,reasons:t}},ei=function(e,t,r,n){var i=es(u.sprintf("%s%s",t,e.id));return n.log(d.DEBUG,u.sprintf(_.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",i,r)),eo(i,e.trafficAllocation)},eo=function(e,t){for(var r=0;r<t.length;r++)if(e<t[r].endOfRange)return t[r].entityId;return null},es=function(e){try{var t=c.v3(e,1)/4294967296;return Math.floor(1e4*t)}catch(t){throw Error(u.sprintf(f.INVALID_BUCKETING_ID,"BUCKETER",e,t.message))}},ea=s.getLogger();function eu(e){return/^\d+$/.test(e)}function el(e){var t=e.indexOf("-"),r=e.indexOf("+");return!(t<0)&&(r<0||t<r)}function ec(e){var t=e.indexOf("-"),r=e.indexOf("+");return!(r<0)&&(t<0||r<t)}function eE(e){var t=e,r="";if(/\s/.test(e))return ea.warn(_.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;if(el(e)?(t=e.substring(0,e.indexOf("-")),r=e.substring(e.indexOf("-")+1)):ec(e)&&(t=e.substring(0,e.indexOf("+")),r=e.substring(e.indexOf("+")+1)),"string"!=typeof t||"string"!=typeof r)return null;var n=t.split(".").length-1;if(n>2)return ea.warn(_.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;var i=t.split(".");if(i.length!=n+1)return ea.warn(_.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;for(var o=0;o<i.length;o++)if(!eu(i[o]))return ea.warn(_.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;return r&&i.push(r),i}var ep="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",ed=s.getLogger(),ef=["exact","exists","gt","ge","lt","le","substring","semver_eq","semver_lt","semver_le","semver_gt","semver_ge"],e_={};function eh(e){return"string"==typeof e||"boolean"==typeof e||V.isNumber(e)}function eg(e,t){var r=e.value,n=typeof r,i=e.name,o=t[i],s=typeof o;return!eh(r)||V.isNumber(r)&&!V.isSafeInteger(r)?(ed.warn(_.UNEXPECTED_CONDITION_VALUE,ep,JSON.stringify(e)),null):null===o?(ed.debug(_.UNEXPECTED_TYPE_NULL,ep,JSON.stringify(e),i),null):eh(o)&&n===s?V.isNumber(o)&&!V.isSafeInteger(o)?(ed.warn(_.OUT_OF_BOUNDS,ep,JSON.stringify(e),i),null):r===o:(ed.warn(_.UNEXPECTED_TYPE,ep,JSON.stringify(e),s,i),null)}function ev(e,t){var r=e.name,n=t[r],i=typeof n,o=e.value;return null!==o&&V.isSafeInteger(o)?null===n?(ed.debug(_.UNEXPECTED_TYPE_NULL,ep,JSON.stringify(e),r),!1):V.isNumber(n)?!!V.isSafeInteger(n)||(ed.warn(_.OUT_OF_BOUNDS,ep,JSON.stringify(e),r),!1):(ed.warn(_.UNEXPECTED_TYPE,ep,JSON.stringify(e),i,r),!1):(ed.warn(_.UNEXPECTED_CONDITION_VALUE,ep,JSON.stringify(e)),!1)}function eI(e,t){var r=e.name,n=t[r],i=e.value;return"string"!=typeof i?(ed.warn(_.UNEXPECTED_CONDITION_VALUE,ep,JSON.stringify(e)),null):null===n?(ed.debug(_.UNEXPECTED_TYPE_NULL,ep,JSON.stringify(e),r),null):"string"!=typeof n?(ed.warn(_.UNEXPECTED_TYPE,ep,JSON.stringify(e),typeof n,r),null):function(e,t){var r=eE(t),n=eE(e);if(!r||!n)return null;for(var i=r.length,o=0;o<n.length;o++){if(i<=o)return el(e)||ec(e)?1:-1;if(eu(r[o])){var s=parseInt(r[o]),a=parseInt(n[o]);if(s>a)return 1;if(s<a)return -1}else{if(r[o]<n[o])return el(e)&&!el(t)?1:-1;if(r[o]>n[o])return!el(e)&&el(t)?-1:1}}return el(t)&&!el(e)?-1:0}(i,n)}e_.exact=eg,e_.exists=function(e,t){return null!=t[e.name]},e_.gt=function(e,t){var r=t[e.name],n=e.value;return ev(e,t)&&null!==n?r>n:null},e_.ge=function(e,t){var r=t[e.name],n=e.value;return ev(e,t)&&null!==n?r>=n:null},e_.lt=function(e,t){var r=t[e.name],n=e.value;return ev(e,t)&&null!==n?r<n:null},e_.le=function(e,t){var r=t[e.name],n=e.value;return ev(e,t)&&null!==n?r<=n:null},e_.substring=function(e,t){var r=e.name,n=t[e.name],i=e.value;return"string"!=typeof i?(ed.warn(_.UNEXPECTED_CONDITION_VALUE,ep,JSON.stringify(e)),null):null===n?(ed.debug(_.UNEXPECTED_TYPE_NULL,ep,JSON.stringify(e),r),null):"string"!=typeof n?(ed.warn(_.UNEXPECTED_TYPE,ep,JSON.stringify(e),typeof n,r),null):-1!==n.indexOf(i)},e_.semver_eq=function(e,t){var r=eI(e,t);return null===r?null:0===r},e_.semver_gt=function(e,t){var r=eI(e,t);return null===r?null:r>0},e_.semver_ge=function(e,t){var r=eI(e,t);return null===r?null:r>=0},e_.semver_lt=function(e,t){var r=eI(e,t);return null===r?null:r<0},e_.semver_le=function(e,t){var r=eI(e,t);return null===r?null:r<=0};var eT=Object.freeze({__proto__:null,evaluate:function(e,t){var r=e.match;if(void 0!==r&&-1===ef.indexOf(r))return ed.warn(_.UNKNOWN_MATCH_TYPE,ep,JSON.stringify(e)),null;var n=e.name;return t.hasOwnProperty(n)||"exists"==r?(r&&e_[r]||eg)(e,t):(ed.debug(_.MISSING_ATTRIBUTE_VALUE,ep,JSON.stringify(e),n),null)}}),eO=s.getLogger(),ey=function(){function e(e){this.typeToEvaluatorMap=V.assign({},e,{custom_attribute:eT})}return e.prototype.evaluate=function(e,t,r){var n=this;return void 0===r&&(r={}),!e||0===e.length||!!x(e,function(e){var i=t[e];if(i){eO.log(d.DEBUG,u.sprintf(_.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",e,JSON.stringify(i.conditions)));var o=x(i.conditions,n.evaluateConditionWithUserAttributes.bind(n,r)),s=null===o?"UNKNOWN":o.toString().toUpperCase();return eO.log(d.DEBUG,u.sprintf(_.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",e,s)),o}return null})},e.prototype.evaluateConditionWithUserAttributes=function(e,t){var r=this.typeToEvaluatorMap[t.type];if(!r)return eO.log(d.WARNING,u.sprintf(_.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(t))),null;try{return r.evaluate(t,e)}catch(e){eO.log(d.ERROR,u.sprintf(f.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",t.type,e.message))}return null},e}();function eN(e){return"string"==typeof e&&""!==e}var eA="DECISION_SERVICE",eR=function(){function e(e){this.audienceEvaluator=new ey(e.UNSTABLE_conditionEvaluators),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}return e.prototype.getVariation=function(e,r,n,i,o){void 0===o&&(o={});var s=this.getBucketingId(n,i),a=[],l=r.key;if(!this.checkIfExperimentIsActive(e,l)){var c=u.sprintf(_.EXPERIMENT_NOT_RUNNING,eA,l);return this.logger.log(d.INFO,c),a.push(c),{result:null,reasons:a}}var E=this.getForcedVariation(e,l,n);a.push.apply(a,E.reasons);var p=E.result;if(p)return{result:p,reasons:a};var f=this.getWhitelistedVariation(r,n);a.push.apply(a,f.reasons);var h=f.result;if(h)return{result:h.key,reasons:a};var g=o[t.kn.IGNORE_USER_PROFILE_SERVICE],v=this.resolveExperimentBucketMap(n,i);if(!g&&(h=this.getStoredVariation(e,r,n,v))){var I=u.sprintf(_.RETURNING_STORED_VARIATION,eA,h.key,l,n);return this.logger.log(d.INFO,I),a.push(I),{result:h.key,reasons:a}}var T=this.checkIfUserIsInAudience(e,r,O.EXPERIMENT,i,"");if(a.push.apply(a,T.reasons),!T.result){var y=u.sprintf(_.USER_NOT_IN_EXPERIMENT,eA,n,l);return this.logger.log(d.INFO,y),a.push(y),{result:null,reasons:a}}var N=en(this.buildBucketerParams(e,r,s,n));a.push.apply(a,N.reasons);var A=N.result;if(A&&(h=e.variationIdMap[A]),!h){var R=u.sprintf(_.USER_HAS_NO_VARIATION,eA,n,l);return this.logger.log(d.DEBUG,R),a.push(R),{result:null,reasons:a}}var m=u.sprintf(_.USER_HAS_VARIATION,eA,n,h.key,l);return this.logger.log(d.INFO,m),a.push(m),g||this.saveUserProfile(r,h,n,v),{result:h.key,reasons:a}},e.prototype.resolveExperimentBucketMap=function(e,t){t=t||{};var r=this.getUserProfile(e)||{},n=t[h.STICKY_BUCKETING_KEY];return V.assign({},r.experiment_bucket_map,n)},e.prototype.checkIfExperimentIsActive=function(e,t){return"Running"===Y(e,t)},e.prototype.getWhitelistedVariation=function(e,t){var r=[];if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(t)){var n=e.forcedVariations[t];if(e.variationKeyMap.hasOwnProperty(n)){var i=u.sprintf(_.USER_FORCED_IN_VARIATION,eA,t,n);return this.logger.log(d.INFO,i),r.push(i),{result:e.variationKeyMap[n],reasons:r}}var o=u.sprintf(_.FORCED_BUCKETING_FAILED,eA,n,t);return this.logger.log(d.ERROR,o),r.push(o),{result:null,reasons:r}}return{result:null,reasons:r}},e.prototype.checkIfUserIsInAudience=function(e,t,r,n,i){var o=[],s=function(e,t){var r=e.experimentIdMap[t];if(!r)throw Error(u.sprintf(f.INVALID_EXPERIMENT_ID,B,t));return r.audienceConditions||r.audienceIds}(e,t.id),a=e.audiencesById,l=u.sprintf(_.EVALUATING_AUDIENCES_COMBINED,eA,r,i||t.key,JSON.stringify(s));this.logger.log(d.DEBUG,l),o.push(l);var c=this.audienceEvaluator.evaluate(s,a,n),E=u.sprintf(_.AUDIENCE_EVALUATION_RESULT_COMBINED,eA,r,i||t.key,c.toString().toUpperCase());return this.logger.log(d.INFO,E),o.push(E),{result:c,reasons:o}},e.prototype.buildBucketerParams=function(e,t,r,n){return{bucketingId:r,experimentId:t.id,experimentKey:t.key,experimentIdMap:e.experimentIdMap,experimentKeyMap:e.experimentKeyMap,groupIdMap:e.groupIdMap,logger:this.logger,trafficAllocationConfig:q(e,t.id),userId:n,variationIdMap:e.variationIdMap}},e.prototype.getStoredVariation=function(e,t,r,n){if(n.hasOwnProperty(t.id)){var i=n[t.id],o=i.variation_id;if(e.variationIdMap.hasOwnProperty(o))return e.variationIdMap[i.variation_id];this.logger.log(d.INFO,u.sprintf(_.SAVED_VARIATION_NOT_FOUND,eA,r,o,t.key))}return null},e.prototype.getUserProfile=function(e){if(!this.userProfileService)return{user_id:e,experiment_bucket_map:{}};try{return this.userProfileService.lookup(e)}catch(t){this.logger.log(d.ERROR,u.sprintf(f.USER_PROFILE_LOOKUP_ERROR,eA,e,t.message))}return null},e.prototype.saveUserProfile=function(e,t,r,n){if(this.userProfileService)try{n[e.id]={variation_id:t.id},this.userProfileService.save({user_id:r,experiment_bucket_map:n}),this.logger.log(d.INFO,u.sprintf(_.SAVED_VARIATION,eA,t.key,e.key,r))}catch(e){this.logger.log(d.ERROR,u.sprintf(f.USER_PROFILE_SAVE_ERROR,eA,r,e.message))}},e.prototype.getVariationForFeature=function(e,t,r,n,i){void 0===i&&(i={});var o=[],s=this.getVariationForFeatureExperiment(e,t,r,n,i);o.push.apply(o,s.reasons);var a=s.result;if(null!==a.variation)return{result:a,reasons:o};var l=this.getVariationForRollout(e,t,r,n);o.push.apply(o,l.reasons);var c=l.result;if(c.variation){var E=u.sprintf(_.USER_IN_ROLLOUT,eA,r,t.key);return this.logger.log(d.DEBUG,E),o.push(E),{result:c,reasons:o}}var p=u.sprintf(_.USER_NOT_IN_ROLLOUT,eA,r,t.key);return this.logger.log(d.DEBUG,p),o.push(p),{result:c,reasons:o}},e.prototype.getVariationForFeatureExperiment=function(e,t,r,n,i){void 0===i&&(i={});var o,s,a=[],l=null;if(t.experimentIds.length>0)for(s=0;s<t.experimentIds.length;s++){var c=W(e,t.experimentIds[s],this.logger);if(c&&(o=this.getVariation(e,c,r,n,i),a.push.apply(a,o.reasons),l=o.result))return{result:{experiment:c,variation:c.variationKeyMap[l],decisionSource:T.FEATURE_TEST},reasons:a}}else{var E=u.sprintf(_.FEATURE_HAS_NO_EXPERIMENTS,eA,t.key);this.logger.log(d.DEBUG,E),a.push(E)}return{result:{experiment:null,variation:null,decisionSource:T.FEATURE_TEST},reasons:a}},e.prototype.getVariationForRollout=function(e,t,r,n){var i=[];if(!t.rolloutId){var o=u.sprintf(_.NO_ROLLOUT_EXISTS,eA,t.key);return this.logger.log(d.DEBUG,o),i.push(o),{result:{experiment:null,variation:null,decisionSource:T.ROLLOUT},reasons:i}}var s=e.rolloutIdMap[t.rolloutId];if(!s){var a=u.sprintf(f.INVALID_ROLLOUT_ID,eA,t.rolloutId,t.key);return this.logger.log(d.ERROR,a),i.push(a),{result:{experiment:null,variation:null,decisionSource:T.ROLLOUT},reasons:i}}if(0===s.experiments.length){var l=u.sprintf(_.ROLLOUT_HAS_NO_EXPERIMENTS,eA,t.rolloutId);return this.logger.log(d.ERROR,l),i.push(l),{result:{experiment:null,variation:null,decisionSource:T.ROLLOUT},reasons:i}}for(var c,E,p,h,g,v,I=this.getBucketingId(r,n),y=s.experiments.length-1,N=0;N<y;N++){if(c=e.experimentIdMap[s.experiments[N].id],h=N+1,v=this.checkIfUserIsInAudience(e,c,O.RULE,n,h),i.push.apply(i,v.reasons),v.result){var A=u.sprintf(_.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,eA,r,h);if(this.logger.log(d.DEBUG,A),i.push(A),g=en(this.buildBucketerParams(e,c,I,r)),i.push.apply(i,g.reasons),(E=g.result)&&(p=e.variationIdMap[E]),p){var R=u.sprintf(_.USER_BUCKETED_INTO_TARGETING_RULE,eA,r,h);return this.logger.log(d.DEBUG,R),i.push(R),{result:{experiment:c,variation:p,decisionSource:T.ROLLOUT},reasons:i}}var m=u.sprintf(_.USER_NOT_BUCKETED_INTO_TARGETING_RULE,eA,r,h);this.logger.log(d.DEBUG,m),i.push(m);break}var S=u.sprintf(_.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,eA,r,h);this.logger.log(d.DEBUG,S),i.push(S)}var L=e.experimentKeyMap[s.experiments[y].key],D=this.checkIfUserIsInAudience(e,L,O.RULE,n,"Everyone Else");if(i.push.apply(i,D.reasons),D.result){var b=u.sprintf(_.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,eA,r,"Everyone Else");if(this.logger.log(d.DEBUG,b),i.push(b),g=en(this.buildBucketerParams(e,L,I,r)),i.push.apply(i,g.reasons),(E=g.result)&&(p=e.variationIdMap[E]),p){var C=u.sprintf(_.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE,eA,r);return this.logger.log(d.DEBUG,C),i.push(C),{result:{experiment:L,variation:p,decisionSource:T.ROLLOUT},reasons:i}}var P=u.sprintf(_.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE,eA,r);this.logger.log(d.DEBUG,P),i.push(P)}return{result:{experiment:null,variation:null,decisionSource:T.ROLLOUT},reasons:i}},e.prototype.getBucketingId=function(e,t){var r=e;return null!=t&&"object"==typeof t&&t.hasOwnProperty(h.BUCKETING_ID)&&("string"==typeof t[h.BUCKETING_ID]?(r=t[h.BUCKETING_ID],this.logger.log(d.DEBUG,u.sprintf(_.VALID_BUCKETING_ID,eA,r))):this.logger.log(d.WARNING,u.sprintf(_.BUCKETING_ID_NOT_STRING,eA))),r},e.prototype.removeForcedVariation=function(e,t,r){if(!e)throw Error(u.sprintf(f.INVALID_USER_ID,eA));if(!this.forcedVariationMap.hasOwnProperty(e))throw Error(u.sprintf(f.USER_NOT_IN_FORCED_VARIATION,eA,e));delete this.forcedVariationMap[e][t],this.logger.log(d.DEBUG,u.sprintf(_.VARIATION_REMOVED_FOR_USER,eA,r,e))},e.prototype.setInForcedVariationMap=function(e,t,r){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][t]=r,this.logger.log(d.DEBUG,u.sprintf(_.USER_MAPPED_TO_FORCED_VARIATION,eA,r,t,e))},e.prototype.getForcedVariation=function(e,t,r){var n,i=[],o=this.forcedVariationMap[r];if(!o)return this.logger.log(d.DEBUG,u.sprintf(_.USER_HAS_NO_FORCED_VARIATION,eA,r)),{result:null,reasons:i};try{var s=z(e,t);if(!s.hasOwnProperty("id")){var a=u.sprintf(f.IMPROPERLY_FORMATTED_EXPERIMENT,eA,t);return this.logger.log(d.ERROR,a),i.push(a),{result:null,reasons:i}}n=s.id}catch(e){return this.logger.log(d.ERROR,e.message),i.push(e.message),{result:null,reasons:i}}var l=o[n];if(!l)return this.logger.log(d.DEBUG,u.sprintf(_.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,eA,t,r)),{result:null,reasons:i};var c=H(e,l);if(c){var E=u.sprintf(_.USER_HAS_FORCED_VARIATION,eA,c,t,r);this.logger.log(d.DEBUG,E),i.push(E)}else this.logger.log(d.DEBUG,u.sprintf(_.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,eA,t,r));return{result:c,reasons:i}},e.prototype.setForcedVariation=function(e,t,r,n){if(null!=n&&!eN(n))return this.logger.log(d.ERROR,u.sprintf(f.INVALID_VARIATION_KEY,eA)),!1;try{var i,o,s=z(e,t);if(!s.hasOwnProperty("id"))return this.logger.log(d.ERROR,u.sprintf(f.IMPROPERLY_FORMATTED_EXPERIMENT,eA,t)),!1;o=s.id}catch(e){return this.logger.log(d.ERROR,e.message),!1}if(null==n)try{return this.removeForcedVariation(r,o,t),!0}catch(e){return this.logger.log(d.ERROR,e.message),!1}var a=(i=e.experimentKeyMap[t]).variationKeyMap.hasOwnProperty(n)?i.variationKeyMap[n].id:null;if(!a)return this.logger.log(d.ERROR,u.sprintf(f.NO_VARIATION_FOR_EXPERIMENT_KEY,eA,n,t)),!1;try{return this.setInForcedVariationMap(r,o,a),!0}catch(e){return this.logger.log(d.ERROR,e.message),!1}},e}();function em(e,t){if(e.hasOwnProperty("revenue")){var r=e.revenue,n=void 0;return"string"==typeof r?isNaN(n=parseInt(r))?(t.log(d.INFO,u.sprintf(_.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r)),null):(t.log(d.INFO,u.sprintf(_.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n)),n):"number"==typeof r?(n=r,t.log(d.INFO,u.sprintf(_.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n)),n):null}return null}function eS(e,t){if(e.hasOwnProperty("value")){var r=e.value,n=void 0;return"string"==typeof r?isNaN(n=parseFloat(r))?(t.log(d.INFO,u.sprintf(_.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r)),null):(t.log(d.INFO,u.sprintf(_.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n)),n):"number"==typeof r?(n=r,t.log(d.INFO,u.sprintf(_.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n)),n):null}return null}function eL(e,t){return"string"==typeof e&&("string"==typeof t||"boolean"==typeof t||V.isNumber(t)&&V.isSafeInteger(t))}var eD="https://logx.optimizely.com/v1/events";function eb(e){var t=e.attributes,r=e.userId,n=e.clientEngine,i=e.clientVersion,o=e.configObj,s=e.logger,a=!!o.anonymizeIP&&o.anonymizeIP,u=o.botFiltering,l={account_id:o.accountId,project_id:o.projectId,visitors:[{snapshots:[],visitor_id:r,attributes:[]}],revision:o.revision,client_name:n,client_version:i,anonymize_ip:a,enrich_decisions:!0};return t&&Object.keys(t||{}).forEach(function(e){if(eL(e,t[e])){var r=K(o,e,s);r&&l.visitors[0].attributes.push({entity_id:r,key:e,type:"custom",value:t[e]})}}),"boolean"==typeof u&&l.visitors[0].attributes.push({entity_id:h.BOT_FILTERING,key:h.BOT_FILTERING,type:"custom",value:u}),l}function eC(e){var t,r;return null!==(r=null===(t=e.experiment)||void 0===t?void 0:t.key)&&void 0!==r?r:""}function eP(e){var t,r;return null!==(r=null===(t=e.variation)||void 0===t?void 0:t.key)&&void 0!==r?r:""}function eU(e){var t,r;return null!==(r=null===(t=e.variation)||void 0===t?void 0:t.featureEnabled)&&void 0!==r&&r}function eM(e){var t,r;return null!==(r=null===(t=e.experiment)||void 0===t?void 0:t.id)&&void 0!==r?r:null}var eV=s.getLogger("EVENT_BUILDER");function eF(e,t){var r=[];return t&&Object.keys(t||{}).forEach(function(n){if(eL(n,t[n])){var i=K(e,n,eV);i&&r.push({entityId:i,key:n,value:t[n]})}}),r}var ex={createEventProcessor:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(a.LogTierV1EventProcessor.bind.apply(a.LogTierV1EventProcessor,p([void 0],e)))},LocalStoragePendingEventsDispatcher:a.LocalStoragePendingEventsDispatcher},ew="USER_PROFILE_SERVICE_VALIDATOR",eB=function(){function e(e){var r,n=this,i=e.clientEngine;-1===g.indexOf(i)&&(e.logger.log(d.INFO,u.sprintf(_.INVALID_CLIENT_ENGINE,"OPTIMIZELY",i)),i="node-sdk"),this.clientEngine=i,this.clientVersion=e.clientVersion||"4.7.0",this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger;var o=null!==(r=e.defaultDecideOptions)&&void 0!==r?r:[];Array.isArray(o)||(this.logger.log(d.DEBUG,u.sprintf(_.INVALID_DEFAULT_DECIDE_OPTIONS,"OPTIMIZELY")),o=[]);var s={};o.forEach(function(e){t.kn[e]?s[e]=!0:n.logger.log(d.WARNING,u.sprintf(_.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",e))}),this.defaultDecideOptions=s,this.projectConfigManager=new et({datafile:e.datafile,datafileOptions:e.datafileOptions,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey}),this.disposeOnUpdate=this.projectConfigManager.onUpdate(function(e){n.logger.log(d.INFO,u.sprintf(_.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",e.revision,e.projectId)),n.notificationCenter.sendNotifications(v.OPTIMIZELY_CONFIG_UPDATE)});var a=this.projectConfigManager.onReady(),l=null;if(e.userProfileService)try{(function(e){if("object"==typeof e&&null!==e){if("function"!=typeof e.lookup)throw Error(u.sprintf(f.INVALID_USER_PROFILE_SERVICE,ew,"Missing function 'lookup'"));if("function"!=typeof e.save)throw Error(u.sprintf(f.INVALID_USER_PROFILE_SERVICE,ew,"Missing function 'save'"));return!0}throw Error(u.sprintf(f.INVALID_USER_PROFILE_SERVICE,ew))})(e.userProfileService)&&(l=e.userProfileService,this.logger.log(d.INFO,u.sprintf(_.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY")))}catch(e){this.logger.log(d.WARNING,e.message)}this.decisionService=new eR({userProfileService:l,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=new er({logger:this.logger,errorHandler:this.errorHandler});var c={dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval,batchSize:e.eventBatchSize,maxQueueSize:e.eventMaxQueueSize,notificationCenter:this.notificationCenter};this.eventProcessor=ex.createEventProcessor(c);var E=this.eventProcessor.start();this.readyPromise=Promise.all([a,E]).then(function(e){return e[0]}),this.readyTimeouts={},this.nextReadyTimeoutId=0}return e.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},e.prototype.activate=function(e,t,r){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","activate")),null;if(!this.validateInputs({experiment_key:e,user_id:t},r))return this.notActivatingExperiment(e,t);var n=this.projectConfigManager.getConfig();if(!n)return null;try{var i=this.getVariation(e,t,r);if(null===i)return this.notActivatingExperiment(e,t);if("Running"!==Y(n,e)){var o=u.sprintf(_.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e);return this.logger.log(d.DEBUG,o),i}var s=z(n,e),a={experiment:s,variation:s.variationKeyMap[i],decisionSource:T.EXPERIMENT};return this.sendImpressionEvent(a,"",t,!0,r),i}catch(r){this.logger.log(d.ERROR,r.message);var l=u.sprintf(_.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(d.INFO,l),this.errorHandler.handleError(r),null}}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.sendImpressionEvent=function(e,t,r,n,i){var o=this.projectConfigManager.getConfig();if(o){var s,a,u,l,c,E,p,d,f,_,h,g,v,I,T,O=(a=(s={decisionObj:e,flagKey:t,enabled:n,userId:r,userAttributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o}).configObj,u=s.decisionObj,l=s.userId,c=s.flagKey,E=s.enabled,p=s.userAttributes,d=s.clientEngine,f=s.clientVersion,_=u.decisionSource,h=eC(u),g=eM(u),v=eP(u),I=null!==g&&""!==v?X(a,g,v):null,T=null!==g?G(a,g):null,{type:"impression",timestamp:V.currentTimestamp(),uuid:V.uuid(),user:{id:l,attributes:eF(a,p)},context:{accountId:a.accountId,projectId:a.projectId,revision:a.revision,clientName:d,clientVersion:f,anonymizeIP:a.anonymizeIP||!1,botFiltering:a.botFiltering},layer:{id:T},experiment:{id:g,key:h},variation:{id:I,key:v},ruleKey:h,flagKey:c,ruleType:_,enabled:E});this.eventProcessor.process(O),this.emitNotificationCenterActivate(e,t,r,n,i)}},e.prototype.emitNotificationCenterActivate=function(e,t,r,n,i){var o=this.projectConfigManager.getConfig();if(o){var s,a=e.decisionSource,u=eC(e),l=eM(e),c=eP(e),E=null;null!==l&&""!==c&&(E=X(o,l,c),s=o.experimentIdMap[l]);var p,d,f,_,h,g,I,T,O,y,N,A,R,m=(N=eb(p={attributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o,experimentId:l,ruleKey:u,flagKey:t,ruleType:a,userId:r,enabled:n,variationId:E,logger:this.logger}),d=p.configObj,f=p.experimentId,_=p.variationId,h=p.ruleKey,g=p.ruleType,I=p.flagKey,T=p.enabled,O=f?G(d,f):null,y=_?H(d,_):null,A={decisions:[{campaign_id:O,experiment_id:f,variation_id:_,metadata:{flag_key:I,rule_key:h,rule_type:g,variation_key:y=y||"",enabled:T}}],events:[{entity_id:O,timestamp:V.currentTimestamp(),key:"campaign_activated",uuid:V.uuid()}]},N.visitors[0].snapshots.push(A),{httpVerb:"POST",url:eD,params:N});s&&s.variationKeyMap&&""!==c&&(R=s.variationKeyMap[c]),this.notificationCenter.sendNotifications(v.ACTIVATE,{experiment:s,userId:r,attributes:i,variation:R,logEvent:m})}},e.prototype.track=function(e,t,r,n){try{if(!this.isValidInstance())return void this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","track"));if(!this.validateInputs({user_id:t,event_key:e},r,n))return;var i,o,s,a,l,c,E,p,f,h,g,v=this.projectConfigManager.getConfig();if(!v)return;if(!v.eventKeyMap.hasOwnProperty(e))return this.logger.log(d.WARNING,u.sprintf(_.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e)),void this.logger.log(d.WARNING,u.sprintf(_.NOT_TRACKING_USER,"OPTIMIZELY",t));var I=(o=(i={eventKey:e,eventTags:n=this.filterEmptyValues(n),userId:t,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:v}).configObj,s=i.userId,a=i.userAttributes,l=i.clientEngine,c=i.clientVersion,E=i.eventKey,p=i.eventTags,f=j(o,E),h=p?em(p,eV):null,g=p?eS(p,eV):null,{type:"conversion",timestamp:V.currentTimestamp(),uuid:V.uuid(),user:{id:s,attributes:eF(o,a)},context:{accountId:o.accountId,projectId:o.projectId,revision:o.revision,clientName:l,clientVersion:c,anonymizeIP:o.anonymizeIP||!1,botFiltering:o.botFiltering},event:{id:f,key:E},revenue:h,value:g,tags:p});this.logger.log(d.INFO,u.sprintf(_.TRACK_EVENT,"OPTIMIZELY",e,t)),this.eventProcessor.process(I),this.emitNotificationCenterTrack(e,t,r,n)}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e);var T=u.sprintf(_.NOT_TRACKING_USER,"OPTIMIZELY",t);this.logger.log(d.ERROR,T)}},e.prototype.emitNotificationCenterTrack=function(e,t,r,n){try{var i,o,s,a=this.projectConfigManager.getConfig();if(!a)return;var u=(i={attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a,eventKey:e,eventTags:n,logger:this.logger,userId:t},o=eb(i),s=function(e,t,r,n){var i={events:[]},o={entity_id:j(e,t),timestamp:V.currentTimestamp(),uuid:V.uuid(),key:t};if(n){var s=em(n,r);null!==s&&(o.revenue=s);var a=eS(n,r);null!==a&&(o.value=a),o.tags=n}return i.events.push(o),i}(i.configObj,i.eventKey,i.logger,i.eventTags),o.visitors[0].snapshots=[s],{httpVerb:"POST",url:eD,params:o});this.notificationCenter.sendNotifications(v.TRACK,{eventKey:e,userId:t,attributes:r,eventTags:n,logEvent:u})}catch(e){this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e)}},e.prototype.getVariation=function(e,t,r){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getVariation")),null;try{if(!this.validateInputs({experiment_key:e,user_id:t},r))return null;var n,i=this.projectConfigManager.getConfig();if(!i)return null;var o=i.experimentKeyMap[e];if(!o)return this.logger.log(d.DEBUG,u.sprintf(f.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e)),null;var s=this.decisionService.getVariation(i,o,t,r).result,a=(n=o.id,i.experimentFeatureMap.hasOwnProperty(n)?I.FEATURE_TEST:I.AB_TEST);return this.notificationCenter.sendNotifications(v.DECISION,{type:a,userId:t,attributes:r||{},decisionInfo:{experimentKey:e,variationKey:s}}),s}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.setForcedVariation=function(e,t,r){if(!this.validateInputs({experiment_key:e,user_id:t}))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;try{return this.decisionService.setForcedVariation(n,e,t,r)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.getForcedVariation=function(e,t){if(!this.validateInputs({experiment_key:e,user_id:t}))return null;var r=this.projectConfigManager.getConfig();if(!r)return null;try{return this.decisionService.getForcedVariation(r,e,t).result}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.validateInputs=function(e,t,r){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if("string"!=typeof n||null===n||"undefined"===n)throw Error(u.sprintf(f.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}return Object.keys(e).forEach(function(t){if(!eN(e[t]))throw Error(u.sprintf(f.INVALID_INPUT_FORMAT,"OPTIMIZELY",t))}),t&&function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw Error(u.sprintf(f.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(e).forEach(function(t){if(void 0===e[t])throw Error(u.sprintf(f.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",t))})}(t),r&&function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw Error(u.sprintf(f.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(r),!0}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.notActivatingExperiment=function(e,t){var r=u.sprintf(_.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(d.INFO,r),null},e.prototype.filterEmptyValues=function(e){for(var t in e)e.hasOwnProperty(t)&&(null===e[t]||void 0===e[t])&&delete e[t];return e},e.prototype.isFeatureEnabled=function(e,t,r){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled")),!1;if(!this.validateInputs({feature_key:e,user_id:t},r))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;var i=J(n,e,this.logger);if(!i)return!1;var o={},s=this.decisionService.getVariationForFeature(n,i,t,r).result,a=s.decisionSource,l=eC(s),c=eP(s),E=eU(s);a===T.FEATURE_TEST&&(o={experimentKey:l,variationKey:c}),(a===T.FEATURE_TEST||a===T.ROLLOUT&&Q(n))&&this.sendImpressionEvent(s,i.key,t,E,r),!0===E?this.logger.log(d.INFO,u.sprintf(_.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,t)):(this.logger.log(d.INFO,u.sprintf(_.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,t)),E=!1);var p={featureKey:e,featureEnabled:E,source:s.decisionSource,sourceInfo:o};return this.notificationCenter.sendNotifications(v.DECISION,{type:I.FEATURE,userId:t,attributes:r||{},decisionInfo:p}),E}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.getEnabledFeatures=function(e,t){var r=this;try{var n=[];if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures")),n;if(!this.validateInputs({user_id:e}))return n;var i=this.projectConfigManager.getConfig();return i&&u.objectValues(i.featureKeyMap).forEach(function(i){r.isFeatureEnabled(i.key,e,t)&&n.push(i.key)}),n}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),[]}},e.prototype.getFeatureVariable=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,null,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariable")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableForType=function(e,t,r,n,i){if(!this.validateInputs({feature_key:e,variable_key:t,user_id:n},i))return null;var o,s,a=this.projectConfigManager.getConfig();if(!a)return null;var l=J(a,e,this.logger);if(!l)return null;var c=(o=this.logger,(s=a.featureKeyMap[e])?s.variableKeyMap[t]||(o.log(d.ERROR,u.sprintf(f.VARIABLE_KEY_NOT_IN_DATAFILE,B,t,e)),null):(o.log(d.ERROR,u.sprintf(f.FEATURE_NOT_IN_DATAFILE,B,e)),null));if(!c)return null;if(r&&c.type!==r)return this.logger.log(d.WARNING,u.sprintf(_.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",r,c.type)),null;var E=this.decisionService.getVariationForFeature(a,l,n,i).result,p=eU(E),h=this.getFeatureVariableValueFromVariation(e,p,E.variation,c,n),g={};return E.decisionSource===T.FEATURE_TEST&&null!==E.experiment&&null!==E.variation&&(g={experimentKey:E.experiment.key,variationKey:E.variation.key}),this.notificationCenter.sendNotifications(v.DECISION,{type:I.FEATURE_VARIABLE,userId:n,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:p,source:E.decisionSource,variableKey:t,variableValue:h,variableType:c.type,sourceInfo:g}}),h},e.prototype.getFeatureVariableValueFromVariation=function(e,t,r,n,i){var o=this.projectConfigManager.getConfig();if(!o)return null;var s=n.defaultValue;if(null!==r){var a=function(e,t,r,n){if(!t||!r)return null;if(!e.variationVariableUsageMap.hasOwnProperty(r.id))return n.log(d.ERROR,u.sprintf(f.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,B,r.id)),null;var i=e.variationVariableUsageMap[r.id][t.id];return i?i.value:null}(o,n,r,this.logger);null!==a?t?(s=a,this.logger.log(d.INFO,u.sprintf(_.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",s,n.key,e))):this.logger.log(d.INFO,u.sprintf(_.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",e,i,s)):this.logger.log(d.INFO,u.sprintf(_.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",n.key,r.key))}else this.logger.log(d.INFO,u.sprintf(_.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",i,n.key,e));return function(e,t,r){var n;switch(t){case y.BOOLEAN:"true"!==e&&"false"!==e?(r.log(d.ERROR,u.sprintf(f.UNABLE_TO_CAST_VALUE,B,e,t)),n=null):n="true"===e;break;case y.INTEGER:isNaN(n=parseInt(e,10))&&(r.log(d.ERROR,u.sprintf(f.UNABLE_TO_CAST_VALUE,B,e,t)),n=null);break;case y.DOUBLE:isNaN(n=parseFloat(e))&&(r.log(d.ERROR,u.sprintf(f.UNABLE_TO_CAST_VALUE,B,e,t)),n=null);break;case y.JSON:try{n=JSON.parse(e)}catch(i){r.log(d.ERROR,u.sprintf(f.UNABLE_TO_CAST_VALUE,B,e,t)),n=null}break;default:n=e}return n}(s,n.type,this.logger)},e.prototype.getFeatureVariableBoolean=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,y.BOOLEAN,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableBoolean")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableDouble=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,y.DOUBLE,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableDouble")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableInteger=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,y.INTEGER,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableInteger")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableString=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,y.STRING,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableString")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableJSON=function(e,t,r,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,y.JSON,r,n):(this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableJSON")),null)}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getAllFeatureVariables=function(e,t,r){var n=this;try{if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","getAllFeatureVariables")),null;if(!this.validateInputs({feature_key:e,user_id:t},r))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;var o=J(i,e,this.logger);if(!o)return null;var s=this.decisionService.getVariationForFeature(i,o,t,r).result,a=eU(s),l={};o.variables.forEach(function(r){l[r.key]=n.getFeatureVariableValueFromVariation(e,a,s.variation,r,t)});var c={};return s.decisionSource===T.FEATURE_TEST&&null!==s.experiment&&null!==s.variation&&(c={experimentKey:s.experiment.key,variationKey:s.variation.key}),this.notificationCenter.sendNotifications(v.DECISION,{type:I.ALL_FEATURE_VARIABLES,userId:t,attributes:r||{},decisionInfo:{featureKey:e,featureEnabled:a,source:s.decisionSource,variableValues:l,sourceInfo:c}}),l}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.close=function(){var e=this;try{var t=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach(function(t){var r=e.readyTimeouts[t];clearTimeout(r.readyTimeout),r.onClose()}),this.readyTimeouts={},t.then(function(){return{success:!0}},function(e){return{success:!1,reason:String(e)}})}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),Promise.resolve({success:!1,reason:String(e)})}},e.prototype.onReady=function(e){var t,r,n=this;"object"==typeof e&&null!==e&&void 0!==e.timeout&&(t=e.timeout),V.isSafeInteger(t)||(t=3e4);var i=new Promise(function(e){r=e}),o=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var s=setTimeout(function(){delete n.readyTimeouts[o],r({success:!1,reason:u.sprintf("onReady timeout expired after %s ms",t)})},t);return this.readyTimeouts[o]={readyTimeout:s,onClose:function(){r({success:!1,reason:"Instance closed"})}},this.readyPromise.then(function(){clearTimeout(s),delete n.readyTimeouts[o],r({success:!0})}),Promise.race([this.readyPromise,i])},e.prototype.createUserContext=function(e,t){return this.validateInputs({user_id:e},t)?new M({optimizely:this,userId:e,attributes:t}):null},e.prototype.decide=function(e,r,n){var i,o,s,a,l=this;void 0===n&&(n=[]);var c=this.projectConfigManager.getConfig(),E=[];if(!this.isValidInstance()||!c)return E.push(A.SDK_NOT_READY),this.logger.log(d.INFO,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","decide")),U(r,e,E);var p=c.featureKeyMap[r];if(!p)return E.push(u.sprintf(A.FLAG_KEY_INVALID,r)),this.logger.log(d.ERROR,u.sprintf(f.FEATURE_NOT_IN_DATAFILE,"OPTIMIZELY",r)),U(r,e,E);var h=e.getUserId(),g=e.getAttributes(),O=this.getAllDecideOptions(n),y=this.decisionService.getVariationForFeature(c,p,h,g,O);E.push.apply(E,y.reasons);var N=y.result,R=N.decisionSource,m=null!==(o=null===(i=N.experiment)||void 0===i?void 0:i.key)&&void 0!==o?o:null,S=null!==(a=null===(s=N.variation)||void 0===s?void 0:s.key)&&void 0!==a?a:null,L=eU(N);!0===L?this.logger.log(d.INFO,u.sprintf(_.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",r,h)):this.logger.log(d.INFO,u.sprintf(_.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",r,h));var D={},b=!1;O[t.kn.EXCLUDE_VARIABLES]||p.variables.forEach(function(e){D[e.key]=l.getFeatureVariableValueFromVariation(r,L,N.variation,e,h)}),!O[t.kn.DISABLE_DECISION_EVENT]&&(R===T.FEATURE_TEST||R===T.ROLLOUT&&Q(c))&&(this.sendImpressionEvent(N,r,h,L,g),b=!0);var C=O[t.kn.INCLUDE_REASONS]?E:[],P={flagKey:r,enabled:L,variationKey:S,ruleKey:m,variables:D,reasons:C,decisionEventDispatched:b};return this.notificationCenter.sendNotifications(v.DECISION,{type:I.FLAG,userId:h,attributes:g,decisionInfo:P}),{variationKey:S,enabled:L,variables:D,ruleKey:m,flagKey:r,userContext:e,reasons:C}},e.prototype.getAllDecideOptions=function(e){var r=this,n=E({},this.defaultDecideOptions);return Array.isArray(e)?e.forEach(function(e){t.kn[e]?n[e]=!0:r.logger.log(d.WARNING,u.sprintf(_.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",e))}):this.logger.log(d.DEBUG,u.sprintf(_.INVALID_DECIDE_OPTIONS,"OPTIMIZELY")),n},e.prototype.decideForKeys=function(e,r,n){var i=this;void 0===n&&(n=[]);var o={};if(!this.isValidInstance())return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","decideForKeys")),o;if(0===r.length)return o;var s=this.getAllDecideOptions(n);return r.forEach(function(r){var a=i.decide(e,r,n);s[t.kn.ENABLED_FLAGS_ONLY]&&!a.enabled||(o[r]=a)}),o},e.prototype.decideAll=function(e,t){void 0===t&&(t=[]);var r=this.projectConfigManager.getConfig();if(!this.isValidInstance()||!r)return this.logger.log(d.ERROR,u.sprintf(_.INVALID_OBJECT,"OPTIMIZELY","decideAll")),{};var n=Object.keys(r.featureKeyMap);return this.decideForKeys(e,n,t)},e}(),ek=s.getLogger();s.setLogHandler(P()),s.setLogLevel(s.LogLevel.INFO);var eG=!1;s.setLogHandler,s.setLogLevel,t.kn,t.Q_=function(e){try{e.errorHandler&&s.setErrorHandler(e.errorHandler),e.logger&&(s.setLogHandler(e.logger),s.setLogLevel(s.LogLevel.NOTSET)),void 0!==e.logLevel&&s.setLogLevel(e.logLevel);try{L(e),e.isValidInstance=!0}catch(t){ek.error(t),e.isValidInstance=!1}var t,r,n=void 0;null==e.eventDispatcher?(n=new a.LocalStoragePendingEventsDispatcher({eventDispatcher:b}),eG||(n.sendPendingEvents(),eG=!0)):n=e.eventDispatcher;var i=e.eventBatchSize,o=e.eventFlushInterval;t=e.eventBatchSize,!("number"!=typeof t||!V.isSafeInteger(t))&&t>=1||(ek.warn("Invalid eventBatchSize %s, defaulting to %s",e.eventBatchSize,10),i=10),r=e.eventFlushInterval,!("number"!=typeof r||!V.isSafeInteger(r))&&r>0||(ek.warn("Invalid eventFlushInterval %s, defaulting to %s",e.eventFlushInterval,1e3),o=1e3);var u=E(E({clientEngine:"javascript-sdk",eventDispatcher:n},e),{eventBatchSize:i,eventFlushInterval:o,logger:ek,errorHandler:s.getErrorHandler()}),l=new eB(u);try{if("function"==typeof window.addEventListener){var c="onpagehide"in window?"pagehide":"unload";window.addEventListener(c,function(){l.close()},!1)}}catch(e){ek.error(_.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",e.message)}return l}catch(e){return ek.error(e),null}},t.vP=R}}]);